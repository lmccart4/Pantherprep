<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Session 2: Practice & Self-Analysis ‚Äî PSAT 8/9 R&W ‚Äî PantherPrep</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Source+Sans+3:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--ink:#f0f0f0;--paper:#121212;--accent:#C8102E;--accent-light:rgba(200,16,46,.15);--border:#2a2a2a;--muted:#999;--surface:#1a1a1a;--craft:#60a5fa;--craft-bg:rgba(96,165,250,.1);--info:#34d399;--info-bg:rgba(52,211,153,.1);--express:#fbbf24;--express-bg:rgba(251,191,36,.1);--convention:#f87171;--convention-bg:rgba(248,113,113,.1);--correct:#22c55e;--correct-bg:rgba(34,197,94,.12);--wrong:#ef4444;--wrong-bg:rgba(239,68,68,.12)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Source Sans 3',sans-serif;background:var(--paper);color:var(--ink);line-height:1.65}
.top-stripe{height:4px;background:linear-gradient(90deg,#C8102E 0%,#C8102E 50%,#fff 50%,#fff 100%);position:fixed;top:0;left:0;right:0;z-index:100}
.container{max-width:800px;margin:0 auto;padding:20px 20px 60px}
.back-link{display:inline-flex;align-items:center;gap:8px;color:var(--muted);font-size:.9rem;padding:8px 0;margin-top:8px;cursor:pointer;text-decoration:none}
.back-link:hover{color:var(--accent)}
.mod-header{padding:40px 0 30px;border-bottom:1px solid var(--border);margin-bottom:32px}
.mod-badge{display:inline-block;background:var(--info);color:#000;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:5px 14px;border-radius:16px;margin-bottom:14px}
.mod-header h1{font-family:'Cormorant Garamond',serif;font-size:clamp(1.8rem,4vw,2.6rem);font-weight:700;margin-bottom:6px}
.mod-header .subtitle{color:var(--muted);font-size:1rem}
.mod-meta{display:flex;gap:20px;margin-top:14px;font-size:.82rem;color:var(--muted)}
.section{margin-bottom:36px}
.section-label{font-size:.7rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--accent);margin-bottom:6px}
.section h2{font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:700;margin-bottom:12px}
.section p{color:#ccc;font-size:.93rem;margin-bottom:12px;line-height:1.7}
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px 20px;margin-bottom:12px}
.card-accent{border-left:3px solid var(--accent)}
.callout{background:var(--accent-light);border:1px solid rgba(200,16,46,.3);border-radius:10px;padding:14px 18px;margin-bottom:16px;font-size:.9rem}
.callout strong{color:var(--accent)}

/* STRATEGY RECAP */
.strat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:16px}
.strat-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px;font-size:.85rem}
.strat-name{font-weight:700;color:var(--accent);margin-bottom:3px;font-size:.9rem}
.strat-desc{color:var(--muted);font-size:.82rem;line-height:1.5}

/* TIMER */
.timer-bar{background:var(--surface);border:2px solid var(--accent);border-radius:12px;padding:16px;text-align:center;margin-bottom:16px}
.timer-display{font-family:'JetBrains Mono',monospace;font-size:2.2rem;font-weight:700;margin-bottom:8px}
.timer-display.running{color:var(--express)}
.timer-display.done{color:var(--correct)}
.timer-display.warning{color:var(--wrong)}
.timer-btn{display:inline-block;padding:8px 24px;border:2px solid var(--accent);border-radius:8px;background:var(--accent);color:#fff;font-family:inherit;font-size:.9rem;font-weight:600;cursor:pointer;margin:0 4px;transition:all .15s}
.timer-btn:hover{background:#a00d24}
.timer-btn.outline{background:transparent;color:var(--accent)}
.timer-btn.outline:hover{background:var(--accent-light)}

/* SAT PRACTICE */
.sat-q{background:var(--paper);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:10px}
.sat-passage{background:var(--surface);border-left:3px solid var(--craft);padding:12px 14px;border-radius:0 8px 8px 0;font-size:.9rem;line-height:1.75;margin-bottom:12px;color:#ddd;font-style:italic}
.sat-stem{font-size:.95rem;font-weight:600;margin-bottom:10px}
.sat-choices{display:flex;flex-direction:column;gap:6px}
.sat-choice{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;background:var(--surface);border:2px solid var(--border);border-radius:10px;cursor:pointer;font-size:.88rem;transition:all .15s}
.sat-choice:hover:not(.sc-dis){border-color:var(--accent);background:var(--accent-light)}
.sat-choice.sc-correct{border-color:var(--correct);background:var(--correct-bg)}
.sat-choice.sc-wrong{border-color:var(--wrong);background:var(--wrong-bg)}
.sat-choice.sc-dis{pointer-events:none;opacity:.6}
.sc-letter{flex-shrink:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--border);font-weight:700;font-size:.78rem}
.sat-choice.sc-correct .sc-letter{background:var(--correct);color:#fff}
.sat-choice.sc-wrong .sc-letter{background:var(--wrong);color:#fff}
.sat-fb{margin-top:8px;padding:10px;border-radius:8px;font-size:.82rem;line-height:1.5;display:none}
.sat-fb.show{display:block}
.sat-fb.sfb-correct{background:var(--correct-bg);border:1px solid var(--correct)}
.sat-fb.sfb-wrong{background:var(--wrong-bg);border:1px solid var(--wrong)}
.domain-tag{display:inline-block;font-size:.68rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;padding:2px 8px;border-radius:10px;margin-right:6px}
.ex-num{font-size:.78rem;font-weight:700;color:var(--muted);margin-bottom:6px}
.ex-score{text-align:center;padding:10px 0;font-size:.88rem;color:var(--muted)}

/* ERROR CODES */
.ec-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;margin-bottom:16px}
.ec-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
.ec-code{font-family:'JetBrains Mono',monospace;font-size:1.4rem;font-weight:700;margin-bottom:2px}
.ec-name{font-weight:700;font-size:.85rem;margin-bottom:2px}
.ec-desc{font-size:.78rem;color:var(--muted);line-height:1.4}

/* ERROR LOG */
.elog{background:var(--surface);border:2px solid var(--convention);border-radius:14px;padding:22px;margin-bottom:16px}
.elog h3{font-family:'Cormorant Garamond',serif;font-size:1.2rem;margin-bottom:4px}
.elog-sub{font-size:.85rem;color:var(--muted);margin-bottom:14px}
.elog-row{display:grid;grid-template-columns:50px 1fr 1fr 1fr;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:.84rem}
.elog-row:last-child{border-bottom:none}
.elog-head{font-weight:700;font-size:.72rem;text-transform:uppercase;letter-spacing:.5px;color:var(--muted)}
.elog-qnum{font-weight:700;font-family:'JetBrains Mono',monospace;text-align:center}
.elog-sel{padding:5px 8px;background:var(--paper);border:1px solid var(--border);border-radius:6px;color:var(--ink);font-family:inherit;font-size:.82rem;width:100%}
.elog-sel:focus{border-color:var(--convention);outline:none}
.elog-summary{margin-top:16px;padding:14px;background:var(--paper);border-radius:10px;border:1px solid var(--border)}
.elog-summary h4{margin-bottom:8px;font-size:.95rem}
.elog-bar-row{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.elog-bar-label{width:120px;font-size:.82rem;color:#ccc;flex-shrink:0}
.elog-bar{flex:1;height:10px;background:var(--border);border-radius:5px;overflow:hidden}
.elog-bar-fill{height:100%;border-radius:5px;transition:width .3s}
.elog-bar-val{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--muted);width:30px;text-align:right;flex-shrink:0}

/* REFLECTION */
.reflect-q{background:var(--paper);border-radius:10px;padding:14px;margin-bottom:8px;border:1px solid var(--border)}
.reflect-num{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:var(--accent);color:#fff;font-weight:700;font-size:.75rem;margin-right:8px}
.reflect-text{font-size:.9rem;color:#ccc;display:inline}
.reflect-input{width:100%;padding:8px 10px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--ink);font-family:inherit;font-size:.85rem;margin-top:8px;resize:vertical;min-height:40px}
.reflect-input:focus{border-color:var(--accent);outline:none}

.btn{display:inline-block;background:var(--accent);color:#fff;font-family:inherit;font-size:.9rem;font-weight:600;padding:10px 24px;border:none;border-radius:8px;cursor:pointer;transition:all .2s}
.btn:hover{background:#a00d24}
.btn-sm{padding:8px 16px;font-size:.82rem}

.mod-nav{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-top:1px solid var(--border);margin-top:40px}
.mod-nav a{color:var(--accent);text-decoration:none;font-weight:600;font-size:.9rem;display:flex;align-items:center;gap:6px}
.mod-nav a:hover{text-decoration:underline}

@media(max-width:600px){.mod-meta{flex-wrap:wrap;gap:10px}.strat-grid{grid-template-columns:1fr}.ec-grid{grid-template-columns:1fr 1fr}.elog-row{grid-template-columns:40px 1fr 1fr}}
</style>
</head>
<body>
<div class="top-stripe"></div>
<div class="container">
<a class="back-link" href="index.html">‚Üê Back to R&W Course</a>

<div class="mod-header">
  <div class="mod-badge">Session 2 ¬∑ Practice</div>
  <h1>Practice Set 1 (Q11‚Äì20) & Self-Analysis</h1>
  <p class="subtitle">Timed practice with Expression of Ideas and Standard English Conventions, followed by guided error analysis.</p>
  <div class="mod-meta">
    <span>‚è± 60 minutes</span>
    <span>üìã 4 sections</span>
    <span>üî® Phase 1: Foundations</span>
  </div>
</div>

<!-- STRATEGY RECAP -->
<div class="section">
  <div class="section-label">Part 1 ¬∑ 5 min</div>
  <h2>Quick Strategy Recap</h2>
  <div class="strat-grid">
    <div class="strat-card"><div class="strat-name">POE</div><div class="strat-desc">Eliminate wrong answers ‚Äî too extreme, unsupported, off-topic, reversed.</div></div>
    <div class="strat-card"><div class="strat-name">POOD</div><div class="strat-desc">Grammar questions first, reading questions second. Bank easier wins early.</div></div>
    <div class="strat-card"><div class="strat-name">LOTD</div><div class="strat-desc">Never leave a blank. Same guessing letter every time.</div></div>
    <div class="strat-card"><div class="strat-name">Self-Correct</div><div class="strat-desc">Score yourself FIRST, diagnose errors, THEN read explanations.</div></div>
  </div>
</div>

<!-- TIMED PRACTICE -->
<div class="section">
  <div class="section-label">Part 2 ¬∑ 15 min</div>
  <h2>Practice Questions 11‚Äì20</h2>
  <p>This set focuses on <strong>Expression of Ideas</strong> (Q11‚Äì12) and <strong>Standard English Conventions</strong> (Q13‚Äì20). Try to answer all 10 within 15 minutes. The timer starts when you click "Start."</p>
  <div class="callout"><strong>Self-Correction Protocol:</strong> Try all questions FIRST without peeking at explanations. After you finish, click "Show Answers" to review. Score yourself before reading the explanations.</div>
  <div class="timer-bar" id="timerBar">
    <div class="timer-display" id="timerDisplay">15:00</div>
    <button class="timer-btn" id="timerStart" onclick="startTimer()">‚ñ∂ Start Timer</button>
    <button class="timer-btn outline" onclick="resetTimer()">‚Ü∫ Reset</button>
  </div>
  <div id="satQuestions"></div>
  <div style="text-align:center;margin:12px 0">
    <button class="btn" id="showBtn" onclick="showAllAnswers()">Show All Answers</button>
  </div>
  <div id="satScore" class="ex-score"></div>
</div>

<!-- ERROR TYPE CODES -->
<div class="section">
  <div class="section-label">Part 3</div>
  <h2>Error Type Codes</h2>
  <p>Use these codes to classify every error in your error log below. Understanding WHY you got something wrong is more important than knowing the right answer.</p>
  <div class="ec-grid">
    <div class="ec-card"><div class="ec-code" style="color:var(--wrong)">MR</div><div class="ec-name">Misread</div><div class="ec-desc">Didn't read the passage or question carefully enough</div></div>
    <div class="ec-card"><div class="ec-code" style="color:var(--craft)">CG</div><div class="ec-name">Content Gap</div><div class="ec-desc">Didn't know the grammar rule or vocabulary</div></div>
    <div class="ec-card"><div class="ec-code" style="color:var(--express)">TF</div><div class="ec-name">Trap/Distractor</div><div class="ec-desc">Wrong answer seemed right because it used passage words</div></div>
    <div class="ec-card"><div class="ec-code" style="color:#f97316">RS</div><div class="ec-name">Rushed</div><div class="ec-desc">Went too fast and made a careless mistake</div></div>
    <div class="ec-card"><div class="ec-code" style="color:var(--info)">OT</div><div class="ec-name">Overthought</div><div class="ec-desc">Talked myself out of the right answer</div></div>
    <div class="ec-card"><div class="ec-code" style="color:var(--muted)">GS</div><div class="ec-name">Guessed</div><div class="ec-desc">Ran out of time or had no idea</div></div>
  </div>
</div>

<!-- ERROR LOG -->
<div class="section">
  <div class="section-label">Part 4 ¬∑ Interactive</div>
  <h2>Error Log</h2>
  <p>For every question you got wrong, select the domain and error type. The summary updates automatically.</p>
  <div class="elog" id="errorLog"></div>
</div>

<!-- REFLECTION -->
<div class="section">
  <div class="section-label">Part 4 (continued)</div>
  <h2>Reflection Questions</h2>
  <p>Answer these honestly ‚Äî they guide your study plan going forward.</p>
  <div id="reflections"></div>
  <div style="text-align:center;margin-top:12px">
    <button class="btn btn-sm" onclick="exportReflections()">üìã Export Error Log & Reflections</button>
  </div>
</div>

<!-- KEY TAKEAWAYS -->
<div class="section">
  <div class="section-label">Summary</div>
  <h2>Key Takeaways</h2>
  <div class="card card-accent">
    <ol style="padding-left:18px;font-size:.93rem;color:#ccc;line-height:2">
      <li>Self-correction is the #1 way to improve: score first, diagnose errors, then read explanations.</li>
      <li>Grammar rules are learnable and predictable ‚Äî content gaps here are the easiest to fix.</li>
      <li>Track your error types: if you're mostly "Rushed" or "Misread," slow down; if "Content Gap," study the rules.</li>
      <li>Your weakest domain from the error log tells you exactly what to focus on next.</li>
      <li>Bring your error patterns to Session 3 ‚Äî we'll target your specific weaknesses.</li>
    </ol>
  </div>
</div>

<div class="mod-nav">
  <a href="module-1.html">‚Üê Session 1: Foundations</a>
  <a href="module-3.html">Session 3: Craft & Structure ‚Üí</a>
</div>
</div>

<script>
// ============ TIMER ============
let timerSec=900,timerInt=null,timerRunning=false;
function updateTimerUI(){
  const m=Math.floor(timerSec/60),s=timerSec%60;
  const el=document.getElementById('timerDisplay');
  el.textContent=`${m}:${s.toString().padStart(2,'0')}`;
  el.className='timer-display'+(timerRunning?' running':'')+(timerSec===0?' done':'')+(timerSec<=120&&timerSec>0?' warning':'');
}
function startTimer(){
  if(timerRunning)return;timerRunning=true;
  document.getElementById('timerStart').textContent='‚è∏ Running';
  timerInt=setInterval(()=>{
    if(timerSec>0){timerSec--;updateTimerUI();}
    else{clearInterval(timerInt);timerRunning=false;document.getElementById('timerStart').textContent='‚è∞ Time!';}
  },1000);
}
function resetTimer(){clearInterval(timerInt);timerRunning=false;timerSec=900;updateTimerUI();document.getElementById('timerStart').textContent='‚ñ∂ Start Timer';}
updateTimerUI();

// ============ PRACTICE QUESTIONS ============
const QS=[
  {domain:'Expression of Ideas',skill:'Rhetorical Synthesis',
   passage:'A wildlife conservation organization wants to write a newsletter article about its wolf reintroduction program. The article should emphasize the ecological benefits of the program to convince donors to continue their financial support.',
   stem:'Which choice most effectively accomplishes this goal?',
   choices:['Wolves are large predators that require vast territories and consume significant amounts of prey, making them expensive animals to relocate and monitor.','Since wolves were reintroduced to Yellowstone in 1995, elk populations have stabilized, streamside vegetation has recovered, and erosion along riverbanks has decreased by 40% ‚Äî a cascade of ecological benefits made possible by your generous support.','The history of wolves in North America is complex, beginning with their widespread presence before European colonization and continuing through centuries of persecution.','Our organization employs twelve full-time staff members and six seasonal researchers dedicated to the wolf reintroduction program.'],
   correct:1,fb:'The goal requires ecological benefits + donor appeal. B cites specific benefits (stabilized elk, recovered vegetation, 40% erosion decrease) AND addresses donors ("your generous support"). A emphasizes costs (discouraging), C gives history (no benefits), D describes staffing (no outcomes).'},
  {domain:'Expression of Ideas',skill:'Rhetorical Synthesis',
   passage:'While researching a paper on renewable energy, a student has taken notes:<br>‚Ä¢ Solar panel costs decreased by 89% since 2010<br>‚Ä¢ Solar = 4.5% of U.S. electricity in 2023<br>‚Ä¢ DOE goal: 45% by 2050<br>‚Ä¢ Battery storage improving to address intermittency<br><br>The student wants to emphasize how much solar energy has grown and its future potential.',
   stem:'Which choice most effectively uses the notes to accomplish this goal?',
   choices:['Solar panels use photovoltaic cells to convert sunlight into electricity, and battery storage technology is helping to solve the problem of intermittent energy production.','The cost of solar panels has dropped by 89% since 2010, and while solar currently provides 4.5% of U.S. electricity, the Department of Energy projects it could reach 45% by 2050.','Solar energy accounted for 4.5% of total U.S. electricity generation in 2023, which represents a significant portion of the national energy supply.','Battery storage technology improvements are essential because solar energy can only be generated when the sun is shining, creating an intermittency problem.'],
   correct:1,fb:'The goal: growth + future potential. B covers both ‚Äî 89% cost decrease (growth), 4.5% now to 45% by 2050 (potential). A explains how solar works (not the goal), C only mentions current %, D focuses on a challenge.'},
  {domain:'Standard English',skill:'Verb Tense',
   passage:'The museum\'s newest exhibit, which features artifacts from ancient Mesopotamia, _________ open to the public since last Tuesday.',
   stem:'Which choice completes the text so that it conforms to Standard English?',
   choices:['is','was','has been','have been'],
   correct:2,fb:'"Since last Tuesday" requires present perfect ‚Äî an action started in the past that continues now. "Has been" is correct (singular "exhibit"). "Is" doesn\'t connect to "since," "was" implies it\'s over, "have been" doesn\'t agree with singular "exhibit."'},
  {domain:'Standard English',skill:'Comma Usage',
   passage:'Although the hikers were exhausted after climbing for six _________ they decided to push forward to reach the summit before sunset.',
   stem:'Which choice conforms to Standard English?',
   choices:['hours they','hours, they','hours. They','hours; and they'],
   correct:1,fb:'A comma separates the introductory dependent clause ("Although...hours") from the main clause ("they decided..."). No comma (A) = run-on. Period (C) creates a fragment since "Although" makes it dependent. Semicolon + "and" (D) is redundant and wrong for dependent clauses.'},
  {domain:'Standard English',skill:'Noun Forms',
   passage:'The three _________ in the talent show each performed original songs that they had written during the school year.',
   stem:'Which choice conforms to Standard English?',
   choices:['guitarist\'s','guitarists','guitarists\'','guitarist'],
   correct:1,fb:'"Three" requires plural. No possession is indicated ‚Äî they\'re performing, not owning. "Guitarists" is simple plural. "Guitarist\'s" = singular possessive, "guitarists\'" = plural possessive, "guitarist" = singular.'},
  {domain:'Standard English',skill:'Punctuation with Clauses',
   passage:'The city council voted to renovate the historic downtown _________ had been neglected for over two decades and was beginning to show serious signs of structural damage.',
   stem:'Which choice conforms to Standard English?',
   choices:['theater, which','theater. Which','theater which,','theater, it'],
   correct:0,fb:'Comma + "which" introduces a nonessential (nonrestrictive) clause giving extra info about the theater. "Theater. Which" (B) creates a fragment. Comma after "which" (C) is misplaced. "Theater, it" (D) is a comma splice.'},
  {domain:'Standard English',skill:'Subject-Verb Agreement',
   passage:'Neither the principal nor the _________ able to attend the awards ceremony due to a scheduling conflict with the district meeting.',
   stem:'Which choice conforms to Standard English?',
   choices:['teachers was','teachers were','teacher\'s were','teacher were'],
   correct:1,fb:'With "neither...nor," the verb agrees with the noun closest to it (proximity rule). "Teachers" (plural) is closest ‚Üí "were." "Was" (A) doesn\'t agree with plural "teachers." "Teacher\'s" (C) is possessive. "Teacher were" (D) mismatches singular noun with plural verb.'},
  {domain:'Standard English',skill:'Sentence Structure',
   passage:'Dr. Amara Chen, a renowned astrophysicist at MIT, recently published a paper arguing that dark matter may interact with ordinary matter through a previously unknown _________ findings challenge several long-standing assumptions in theoretical physics.',
   stem:'Which choice conforms to Standard English?',
   choices:['force, her','force. Her','force her','force, which her'],
   correct:1,fb:'Two independent clauses need proper separation. A period (B) correctly separates them. Comma only (A) = comma splice. No punctuation (C) = run-on. "Which her" (D) creates a garbled construction.'},
  {domain:'Standard English',skill:'Serial Comma',
   passage:'The recipe calls for three cups of flour, two eggs, a tablespoon of _________ a teaspoon of vanilla extract.',
   stem:'Which choice conforms to Standard English?',
   choices:['sugar, and','sugar and,','sugar, and,','sugar and'],
   correct:0,fb:'Standard serial comma: comma before "and" in a list of 4+ items. "Sugar, and" correctly places the comma before the conjunction. Comma after "and" (B) is misplaced. Double commas (C) is excessive. Missing comma (D) can cause misreading.'},
  {domain:'Standard English',skill:'Verb Forms',
   passage:'To prepare for the science fair, Maya spent three weeks _________ her experiment, collecting data every morning before school and analyzing her results each evening.',
   stem:'Which choice conforms to Standard English?',
   choices:['conducting','to conduct','conducted','having conducted'],
   correct:0,fb:'"Spent + time" takes the -ing form: "spent three weeks conducting." It\'s also parallel with "collecting" and "analyzing." "To conduct" (B) is idiomatically wrong. "Conducted" (C) jams two past forms together. "Having conducted" (D) implies it was finished before the three weeks.'},
];
const DOM_COLORS={
  'Expression of Ideas':{bg:'rgba(251,191,36,.15)',color:'#fbbf24'},
  'Standard English':{bg:'rgba(248,113,113,.15)',color:'#f87171'},
};
let satAns={};let answersShown=false;
function renderSAT(){
  document.getElementById('satQuestions').innerHTML=QS.map((q,i)=>{
    const ans=satAns[i];const has=ans!==undefined;const showFb=answersShown&&has;
    const dc=DOM_COLORS[q.domain]||{bg:'rgba(200,16,46,.15)',color:'#C8102E'};
    return `<div class="sat-q">
      <div class="ex-num"><span class="domain-tag" style="background:${dc.bg};color:${dc.color}">${q.domain}</span> ${q.skill} ¬∑ Q${i+11}</div>
      <div class="sat-passage">${q.passage}</div>
      <div class="sat-stem">${q.stem}</div>
      <div class="sat-choices">${q.choices.map((ch,ci)=>{
        let cls='sat-choice';
        if(answersShown&&has){cls+=' sc-dis';if(ci===q.correct)cls+=' sc-correct';else if(ci===ans&&ci!==q.correct)cls+=' sc-wrong';}
        else if(has&&ci===ans){cls+=' sat-choice';cls=cls.replace('sat-choice','sat-choice');cls+='';/* selected style */}
        return `<div class="${cls}" style="${has&&ci===ans&&!answersShown?'border-color:var(--accent);background:var(--accent-light)':''}" onclick="pickAns(${i},${ci})"><div class="sc-letter">${'ABCD'[ci]}</div><div>${ch}</div></div>`;
      }).join('')}</div>
      <div class="sat-fb${showFb?' show':''}${showFb?(ans===q.correct?' sfb-correct':' sfb-wrong'):''}">${showFb?(ans===q.correct?'‚úì Correct! ':'‚úó Incorrect. ')+q.fb:''}</div></div>`;
  }).join('');
  if(answersShown){
    const t=QS.length,a=Object.keys(satAns).length,c=Object.entries(satAns).filter(([i,v])=>v===QS[i].correct).length;
    document.getElementById('satScore').innerHTML=`<strong style="color:${c>=8?'var(--correct)':c>=5?'var(--express)':'var(--wrong)'}">${c}/${t} correct</strong> (${Math.round(c/t*100)}%)`;
    document.getElementById('showBtn').style.display='none';
    renderErrorLog();
  }
}
function pickAns(i,ci){if(answersShown)return;satAns[i]=ci;renderSAT();}
function showAllAnswers(){
  if(Object.keys(satAns).length<QS.length){
    const missing=QS.length-Object.keys(satAns).length;
    if(!confirm(`You have ${missing} unanswered question${missing>1?'s':''}. Show answers anyway?`))return;
  }
  answersShown=true;if(timerRunning){clearInterval(timerInt);timerRunning=false;}
  renderSAT();
}
renderSAT();

// ============ ERROR LOG ============
const DOMAINS=['Expression of Ideas','Standard English','Information & Ideas','Craft & Structure'];
const ETYPES=['MR ‚Äî Misread','CG ‚Äî Content Gap','TF ‚Äî Trap/Distractor','RS ‚Äî Rushed','OT ‚Äî Overthought','GS ‚Äî Guessed'];
const ETYPE_COLORS={'MR':'var(--wrong)','CG':'var(--craft)','TF':'var(--express)','RS':'#f97316','OT':'var(--info)','GS':'var(--muted)'};
const ELK='pp_p89rw_s2_elog';
function loadEL(){return JSON.parse(localStorage.getItem(ELK)||'{}');}
function saveEL(d){localStorage.setItem(ELK,JSON.stringify(d));}

function renderErrorLog(){
  const el=loadEL();
  // figure out which questions were wrong
  const wrongQs=[];
  if(answersShown){
    QS.forEach((q,i)=>{if(satAns[i]!==undefined&&satAns[i]!==q.correct)wrongQs.push(i);});
  }
  
  let html=`<h3>üìã Error Log</h3><div class="elog-sub">${wrongQs.length===0&&answersShown?'No errors! Great work!':'Log each error with its domain and error type.'}</div>`;
  
  if(wrongQs.length>0){
    html+=`<div class="elog-row"><div class="elog-head">Q#</div><div class="elog-head">Domain</div><div class="elog-head">Error Type</div><div class="elog-head">Skill</div></div>`;
    wrongQs.forEach(i=>{
      const q=QS[i];
      html+=`<div class="elog-row">
        <div class="elog-qnum">${i+11}</div>
        <div><select class="elog-sel" onchange="updateEL(${i},'dom',this.value)"><option value="">‚Äî</option>${DOMAINS.map(d=>`<option${el[i]?.dom===d?' selected':''}>${d}</option>`).join('')}</select></div>
        <div><select class="elog-sel" onchange="updateEL(${i},'et',this.value)"><option value="">‚Äî</option>${ETYPES.map(e=>`<option${el[i]?.et===e?' selected':''}>${e}</option>`).join('')}</select></div>
        <div style="font-size:.8rem;color:var(--muted)">${q.skill}</div></div>`;
    });
    
    // Summary
    const etCounts={};const domCounts={};
    wrongQs.forEach(i=>{
      const d=el[i];if(!d)return;
      if(d.et){const code=d.et.split(' ‚Äî ')[0];etCounts[code]=(etCounts[code]||0)+1;}
      if(d.dom){domCounts[d.dom]=(domCounts[d.dom]||0)+1;}
    });
    const maxET=Math.max(1,...Object.values(etCounts));
    const maxDom=Math.max(1,...Object.values(domCounts));
    
    html+=`<div class="elog-summary"><h4>Error Summary</h4>`;
    if(Object.keys(etCounts).length>0){
      html+=`<div style="font-size:.78rem;font-weight:700;color:var(--muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:1px">By Type</div>`;
      Object.entries(etCounts).sort((a,b)=>b[1]-a[1]).forEach(([k,v])=>{
        html+=`<div class="elog-bar-row"><div class="elog-bar-label" style="color:${ETYPE_COLORS[k]||'var(--muted)'}">${k}</div><div class="elog-bar"><div class="elog-bar-fill" style="width:${v/maxET*100}%;background:${ETYPE_COLORS[k]||'var(--muted)'}"></div></div><div class="elog-bar-val">${v}</div></div>`;
      });
    }
    if(Object.keys(domCounts).length>0){
      html+=`<div style="font-size:.78rem;font-weight:700;color:var(--muted);margin:10px 0 6px;text-transform:uppercase;letter-spacing:1px">By Domain</div>`;
      const domColors={'Expression of Ideas':'var(--express)','Standard English':'var(--convention)','Information & Ideas':'var(--info)','Craft & Structure':'var(--craft)'};
      Object.entries(domCounts).sort((a,b)=>b[1]-a[1]).forEach(([k,v])=>{
        html+=`<div class="elog-bar-row"><div class="elog-bar-label" style="color:${domColors[k]||'#ccc'}">${k}</div><div class="elog-bar"><div class="elog-bar-fill" style="width:${v/maxDom*100}%;background:${domColors[k]||'var(--muted)'}"></div></div><div class="elog-bar-val">${v}</div></div>`;
      });
    }
    html+=`</div>`;
  } else if(!answersShown){
    html+=`<p style="color:var(--muted);font-size:.88rem;text-align:center;padding:20px 0">Complete the practice questions and click "Show Answers" to populate the error log.</p>`;
  }
  
  document.getElementById('errorLog').innerHTML=html;
}
function updateEL(i,field,val){const d=loadEL();if(!d[i])d[i]={};d[i][field]=val;saveEL(d);renderErrorLog();}
renderErrorLog();

// ============ REFLECTIONS ============
const REFLECT_QS=[
  'Which domain had the most errors? (This is your #1 priority to study.)',
  'What was your most common error type? (This tells you HOW to change your approach.)',
  'Were there questions where you changed your answer from right to wrong?',
  'Did you run out of time? (If so, try "Second Half First" next time.)',
  'Which questions did you get right that you weren\'t sure about? (Your POE skills may be better than you think.)',
];
const RK='pp_p89rw_s2_reflect';
function loadR(){return JSON.parse(localStorage.getItem(RK)||'{}');}
function saveR(d){localStorage.setItem(RK,JSON.stringify(d));}
function renderReflect(){
  const d=loadR();
  document.getElementById('reflections').innerHTML=REFLECT_QS.map((q,i)=>`
    <div class="reflect-q"><span class="reflect-num">${i+1}</span><span class="reflect-text">${q}</span>
    <textarea class="reflect-input" placeholder="Your answer..." oninput="saveReflect(${i},this.value)">${d[i]||''}</textarea></div>`).join('');
}
function saveReflect(i,v){const d=loadR();d[i]=v;saveR(d);}
renderReflect();

// ============ EXPORT ============
function exportReflections(){
  const el=loadEL();const r=loadR();
  let t='SESSION 2 ERROR LOG & REFLECTIONS ‚Äî PantherPrep PSAT 8/9 R&W\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
  if(answersShown){
    const c=Object.entries(satAns).filter(([i,v])=>v===QS[i].correct).length;
    t+=`SCORE: ${c}/${QS.length} (${Math.round(c/QS.length*100)}%)\n\n`;
  }
  t+='ERROR LOG:\n';
  Object.entries(el).forEach(([i,d])=>{t+=`  Q${parseInt(i)+11}: ${d.dom||'‚Äî'} | ${d.et||'‚Äî'} | ${QS[i]?.skill||''}\n`;});
  t+='\nREFLECTIONS:\n';
  REFLECT_QS.forEach((q,i)=>{t+=`  ${i+1}. ${q}\n     ‚Üí ${r[i]||'(not answered)'}\n\n`;});
  navigator.clipboard.writeText(t).then(()=>alert('Copied to clipboard!')).catch(()=>{const a=document.createElement('textarea');a.value=t;document.body.appendChild(a);a.select();document.execCommand('copy');document.body.removeChild(a);alert('Copied!');});
}
</script>
<script src="/translate.js"></script></body>
</html>
