<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Module 4: Problem-Solving & Data Analysis ‚Äî PSAT/NMSQT Math ‚Äî PantherPrep</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Source+Sans+3:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--ink:#f0f0f0;--paper:#121212;--accent:#C8102E;--accent-light:rgba(200,16,46,.15);--border:#2a2a2a;--muted:#999;--surface:#1a1a1a;--math:#60a5fa;--math-bg:rgba(96,165,250,.1);--algebra:#34d399;--algebra-bg:rgba(52,211,153,.1);--advanced:#a78bfa;--adv-bg:rgba(167,139,250,.1);--psda:#fbbf24;--psda-bg:rgba(251,191,36,.1);--geotrig:#f87171;--correct:#22c55e;--correct-bg:rgba(34,197,94,.12);--wrong:#ef4444;--wrong-bg:rgba(239,68,68,.12);--danger:#ef4444;--danger-bg:rgba(239,68,68,.08)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Source Sans 3',sans-serif;background:var(--paper);color:var(--ink);line-height:1.65;overflow-x:hidden}
.top-stripe{height:4px;background:linear-gradient(90deg,#C8102E 0%,#C8102E 50%,#fff 50%,#fff 100%);position:fixed;top:0;left:0;right:0;z-index:100}

.screen{display:none;opacity:0;transition:opacity .4s ease;min-height:100vh}
.screen.active{display:block;opacity:1}
.screen.fade-in{animation:fadeIn .4s ease forwards}
.screen.fade-out{animation:fadeOut .3s ease forwards}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeOut{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-12px)}}

.screen-progress{position:fixed;top:12px;left:50%;transform:translateX(-50%);display:flex;gap:8px;z-index:101;padding:6px 14px;background:rgba(18,18,18,.85);backdrop-filter:blur(8px);border-radius:20px;border:1px solid var(--border)}
.screen-dot{width:8px;height:8px;border-radius:50%;background:var(--border);transition:all .3s;cursor:pointer}
.screen-dot.completed{background:var(--psda)}
.screen-dot.current{background:var(--accent);box-shadow:0 0 8px rgba(200,16,46,.5);transform:scale(1.25)}
.screen-dot:hover{transform:scale(1.3)}

.container{max-width:800px;margin:0 auto;padding:20px 20px 60px}

.welcome-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 20px;text-align:center}
.welcome-badge{display:inline-block;background:var(--psda);color:#000;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:5px 14px;border-radius:16px;margin-bottom:18px}
.welcome-screen h1{font-family:'Cormorant Garamond',serif;font-size:clamp(2rem,5vw,3rem);font-weight:700;margin-bottom:8px;max-width:600px}
.welcome-sub{color:var(--muted);font-size:1.05rem;max-width:500px;margin:0 auto 32px}
.welcome-meta{display:flex;gap:24px;justify-content:center;margin-bottom:36px;font-size:.85rem;color:var(--muted)}
.preview-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;max-width:600px;width:100%;margin-bottom:40px}
.preview-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 14px;text-align:left;transition:all .2s}
.preview-card:hover{border-color:var(--psda);transform:translateY(-2px)}
.preview-icon{font-size:1.4rem;margin-bottom:8px}
.preview-title{font-size:.82rem;font-weight:700;margin-bottom:3px}
.preview-desc{font-size:.72rem;color:var(--muted);line-height:1.4}
.start-btn{padding:14px 36px;background:var(--psda);color:#000;border:none;border-radius:10px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .2s;font-family:'Source Sans 3',sans-serif}
.start-btn:hover{filter:brightness(1.15);transform:translateY(-1px);box-shadow:0 6px 20px rgba(251,191,36,.3)}

.warmup-container{max-width:600px;margin:0 auto;padding:60px 20px}
.warmup-header{text-align:center;margin-bottom:32px}
.warmup-badge{display:inline-block;background:var(--advanced);color:#fff;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:4px 12px;border-radius:12px;margin-bottom:12px}
.warmup-dots{display:flex;gap:8px;justify-content:center;margin-top:16px}
.warmup-dot{width:10px;height:10px;border-radius:50%;background:var(--border);transition:all .3s}
.warmup-dot.done-correct{background:var(--correct)}
.warmup-dot.done-wrong{background:var(--wrong)}
.warmup-dot.active{background:var(--advanced);box-shadow:0 0 8px rgba(167,139,250,.4)}
.warmup-q{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:16px}
.warmup-q .source-tag{font-size:.7rem;color:var(--advanced);font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:8px}
.warmup-q .q-text{font-size:.95rem;line-height:1.7;margin-bottom:14px}
.warmup-choices{display:flex;flex-direction:column;gap:8px}
.warmup-choice{display:flex;align-items:center;gap:10px;padding:11px 14px;background:var(--paper);border:2px solid var(--border);border-radius:8px;cursor:pointer;font-size:.88rem;transition:all .15s}
.warmup-choice:hover:not(.wu-dis){border-color:var(--advanced);background:rgba(167,139,250,.05)}
.warmup-choice.wu-correct{border-color:var(--correct);background:var(--correct-bg)}
.warmup-choice.wu-wrong{border-color:var(--wrong);background:var(--wrong-bg)}
.warmup-choice.wu-dis{pointer-events:none;opacity:.7}
.warmup-choice.wu-correct{opacity:1}
.warmup-fb{font-size:.85rem;color:var(--muted);line-height:1.6;margin-top:12px;padding:10px;background:var(--paper);border-radius:8px;border-left:3px solid var(--correct)}
.warmup-next{padding:10px 24px;background:var(--advanced);color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:.88rem;margin-top:12px;font-family:'Source Sans 3',sans-serif}
.warmup-next:hover{filter:brightness(1.1)}
.warmup-summary{text-align:center;padding:40px 20px}
.warmup-score{font-family:'JetBrains Mono',monospace;font-size:2.4rem;font-weight:700;color:var(--advanced);margin:12px 0}
.warmup-continue{padding:12px 28px;background:var(--psda);color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:.95rem;margin-top:20px;font-family:'Source Sans 3',sans-serif}
.warmup-continue:hover{filter:brightness(1.15)}

.back-link{display:inline-flex;align-items:center;gap:8px;color:var(--muted);font-size:.9rem;padding:8px 0;margin-top:8px;cursor:pointer;text-decoration:none}
.back-link:hover{color:var(--accent)}
.mod-header{padding:40px 0 30px;border-bottom:1px solid var(--border);margin-bottom:32px}
.mod-badge{display:inline-block;background:var(--psda);color:#000;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:5px 14px;border-radius:16px;margin-bottom:14px}
.mod-header h1{font-family:'Cormorant Garamond',serif;font-size:clamp(1.8rem,4vw,2.6rem);font-weight:700;margin-bottom:6px}
.mod-header .subtitle{color:var(--muted);font-size:1rem}
.mod-meta{display:flex;gap:20px;margin-top:14px;font-size:.82rem;color:var(--muted)}
.section{margin-bottom:36px}
.section-label{font-size:.7rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--psda);margin-bottom:6px}
.section h2{font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:700;margin-bottom:12px}
.section p{color:#ccc;font-size:.93rem;margin-bottom:12px;line-height:1.7}
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px 20px;margin-bottom:12px}
.card-accent{border-left:3px solid var(--accent)}
.callout{background:var(--accent-light);border:1px solid rgba(200,16,46,.3);border-radius:10px;padding:14px 18px;margin-bottom:16px;font-size:.9rem}
.callout strong{color:var(--accent)}
.callout-blue{background:var(--math-bg);border-color:rgba(96,165,250,.3)}
.callout-blue strong{color:var(--math)}
.callout-yellow{background:var(--psda-bg);border-color:rgba(251,191,36,.3)}
.callout-yellow strong{color:var(--psda)}
.topic{background:var(--surface);border:1px solid var(--border);border-radius:14px;margin-bottom:10px;overflow:hidden;transition:all .2s}
.topic-header{display:flex;align-items:center;gap:12px;padding:14px 18px;cursor:pointer}
.topic-header:hover{background:rgba(251,191,36,.05)}
.topic-title{font-weight:700;font-size:.95rem;flex:1}
.topic-arrow{color:var(--muted);font-size:.9rem;transition:transform .2s;flex-shrink:0}
.topic.open .topic-arrow{transform:rotate(90deg)}
.topic-body{display:none;padding:0 18px 18px;font-size:.93rem;color:#ccc;line-height:1.7}
.topic.open .topic-body{display:block}
.topic-body h4{color:var(--ink);font-size:.9rem;margin:14px 0 6px;text-transform:uppercase;letter-spacing:.5px}
.topic-body ul{padding-left:18px;margin-bottom:10px}
.topic-body li{margin-bottom:6px}

.fm-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.fm-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
.fm-name{font-weight:700;font-size:.82rem;color:var(--psda);margin-bottom:4px}
.fm-eq{font-family:'JetBrains Mono',monospace;font-size:.88rem}

.exercise{background:var(--surface);border:2px solid var(--psda);border-radius:14px;padding:22px;margin-bottom:16px}
.exercise h3{font-family:'Cormorant Garamond',serif;font-size:1.15rem;margin-bottom:4px}
.exercise-sub{font-size:.82rem;color:var(--muted);margin-bottom:14px}
.ex-item{background:var(--paper);border-radius:10px;padding:14px;margin-bottom:10px;border:1px solid var(--border)}
.ex-prompt{font-size:.93rem;margin-bottom:10px;line-height:1.6;color:#ddd}
.ex-prompt code{background:var(--psda-bg);color:var(--psda);padding:1px 6px;border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:.85rem}
.ex-input-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.ex-input{padding:8px 12px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--ink);font-family:'JetBrains Mono',monospace;font-size:.95rem;width:120px}
.ex-input:focus{border-color:var(--psda);outline:none}
.ex-btn{padding:8px 16px;background:var(--psda);color:#000;border:none;border-radius:6px;cursor:pointer;font-family:inherit;font-size:.85rem;font-weight:600}
.ex-btn:hover{background:#e0a800}
.ex-fb{font-size:.85rem;padding:8px 12px;border-radius:6px;margin-top:8px;display:none;line-height:1.5}
.ex-fb.show{display:block}
.ex-fb.correct{background:var(--correct-bg);color:var(--correct);border:1px solid var(--correct)}
.ex-fb.wrong{background:var(--wrong-bg);color:var(--wrong);border:1px solid var(--wrong)}
.classify-opts{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:4px}
.classify-opt{padding:6px 14px;background:var(--surface);border:2px solid var(--border);border-radius:8px;cursor:pointer;font-size:.82rem;transition:all .15s}
.classify-opt:hover:not(.cl-dis){border-color:var(--psda);background:var(--psda-bg)}
.classify-opt.cl-correct{border-color:var(--correct);background:var(--correct-bg);color:var(--correct)}
.classify-opt.cl-wrong{border-color:var(--wrong);background:var(--wrong-bg);color:var(--wrong)}
.classify-opt.cl-dis{pointer-events:none;opacity:.7}
.mc-choices{display:flex;flex-direction:column;gap:6px}
.mc-choice{padding:10px 14px;background:var(--surface);border:2px solid var(--border);border-radius:8px;cursor:pointer;font-size:.88rem;transition:all .15s;display:flex;align-items:center;gap:10px}
.mc-choice:hover:not(.mc-dis){border-color:var(--psda);background:var(--psda-bg)}
.mc-letter{font-weight:700;color:var(--muted);min-width:24px;font-family:'JetBrains Mono',monospace}
.mc-choice.mc-correct{border-color:var(--correct);background:var(--correct-bg)}
.mc-choice.mc-wrong{border-color:var(--wrong);background:var(--wrong-bg)}
.mc-choice.mc-dis{pointer-events:none;opacity:.7}
.mc-choice.mc-correct .mc-letter{color:var(--correct)}.mc-choice.mc-wrong .mc-letter{color:var(--wrong)}
.mc-fb{font-size:.85rem;color:var(--muted);line-height:1.6;margin-top:8px;display:none;border-left:3px solid var(--correct);background:var(--paper);padding:8px 12px;border-radius:6px}.mc-fb.show{display:block}
.score-bar{display:flex;align-items:center;gap:10px;margin-top:14px;padding-top:10px;border-top:1px solid var(--border)}
.score-bar-label{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted)}
.score-bar-track{flex:1;height:6px;border-radius:3px;background:var(--border);overflow:hidden}
.score-bar-fill{height:100%;border-radius:3px;background:var(--correct);transition:width .4s ease}
.score-bar-val{font-family:'JetBrains Mono',monospace;font-size:.85rem;font-weight:700;color:var(--correct);min-width:36px;text-align:right}
.tier{font-size:.68rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:2px 8px;border-radius:4px;margin-right:8px}
.tier-1{background:rgba(52,211,153,.15);color:var(--algebra)}.tier-2{background:var(--math-bg);color:var(--math)}.tier-3{background:var(--adv-bg);color:var(--advanced)}

.data-table{width:100%;border-collapse:collapse;font-size:.88rem;margin-bottom:16px}
.data-table th,.data-table td{padding:10px 12px;border:1px solid var(--border);text-align:center}
.data-table th{background:var(--surface);font-weight:700;font-size:.78rem;text-transform:uppercase;letter-spacing:.5px;color:var(--muted)}
.data-table td{color:#ccc}
.data-table .highlight{font-weight:700;color:var(--psda);background:var(--psda-bg)}

.stat-exp{background:var(--surface);border:2px solid var(--psda);border-radius:14px;padding:22px;margin-bottom:16px}
.stat-input{width:100%;padding:10px 14px;background:var(--paper);border:1px solid var(--border);border-radius:8px;color:var(--ink);font-family:'JetBrains Mono',monospace;font-size:.95rem;margin-bottom:14px}
.stat-input:focus{border-color:var(--psda);outline:none}
.stat-results{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.stat-result{background:var(--paper);border-radius:8px;padding:12px;text-align:center}
.stat-val{font-family:'JetBrains Mono',monospace;font-size:1.2rem;font-weight:700}
.stat-label{font-size:.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:2px}

.trap-taxonomy{margin-bottom:24px}
.trap-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 18px;margin-bottom:10px;display:flex;gap:14px;align-items:flex-start;transition:all .2s}
.trap-card:hover{border-color:var(--accent);transform:translateX(3px)}
.trap-number{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.78rem;color:#fff;flex-shrink:0}
.trap-card-body{flex:1}
.trap-card-name{font-weight:700;font-size:.92rem;margin-bottom:3px}
.trap-card-desc{font-size:.82rem;color:var(--muted);line-height:1.5}
.trap-card-example{font-size:.78rem;color:var(--math);font-family:'JetBrains Mono',monospace;margin-top:4px}

.confidence-row{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap}
.conf-tag{padding:5px 12px;border-radius:6px;font-size:.75rem;font-weight:600;cursor:pointer;border:2px solid var(--border);background:var(--surface);transition:all .15s;letter-spacing:.5px}
.conf-tag:hover{border-color:var(--psda)}
.conf-tag.selected{border-color:var(--psda);background:rgba(251,191,36,.12);color:var(--psda)}
.conf-tag[data-conf="guessing"].selected{border-color:var(--psda);background:rgba(251,191,36,.12);color:var(--psda)}
.conf-tag[data-conf="unsure"].selected{border-color:var(--math);background:var(--math-bg);color:var(--math)}
.conf-tag[data-conf="confident"].selected{border-color:var(--advanced);background:rgba(167,139,250,.12);color:var(--advanced)}

.timer-bar{position:sticky;top:8px;z-index:50;background:rgba(18,18,18,.92);backdrop-filter:blur(8px);border:1px solid var(--border);border-radius:12px;padding:10px 16px;margin-bottom:20px;display:flex;align-items:center;gap:14px}
.timer-display{font-family:'JetBrains Mono',monospace;font-size:1.1rem;font-weight:700;color:var(--psda);min-width:60px}
.timer-display.warning{color:var(--psda)}
.timer-display.danger{color:var(--wrong);animation:pulse 1s ease infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.timer-track{flex:1;height:4px;background:var(--border);border-radius:2px;overflow:hidden}
.timer-fill{height:100%;background:var(--psda);transition:width 1s linear;border-radius:2px}
.timer-fill.warning{background:var(--psda)}
.timer-fill.danger{background:var(--wrong)}
.timer-toggle{padding:5px 12px;background:var(--surface);border:1px solid var(--border);border-radius:6px;font-size:.75rem;color:var(--muted);cursor:pointer;font-family:'Source Sans 3',sans-serif;font-weight:600}
.timer-toggle:hover{border-color:var(--accent);color:var(--ink)}
.timer-toggle.active{background:var(--accent-light);border-color:var(--accent);color:var(--accent)}
.q-dots{display:flex;gap:4px}
.q-dot{width:8px;height:8px;border-radius:50%;background:var(--border)}
.q-dot.correct{background:var(--correct)}
.q-dot.wrong{background:var(--wrong)}

.results-section{margin-top:24px;padding:20px;background:var(--surface);border:1px solid var(--border);border-radius:14px}
.results-section h3{font-family:'Cormorant Garamond',serif;font-size:1.3rem;margin-bottom:14px}
.results-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2px;margin-bottom:16px;background:var(--border);border-radius:10px;overflow:hidden}
.results-grid-header{background:var(--surface);padding:8px;text-align:center;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted)}
.results-grid-cell{background:var(--paper);padding:10px 8px;text-align:center;font-size:.78rem;min-height:50px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px}
.results-grid-cell.danger-cell{background:var(--danger-bg);border:1px solid rgba(239,68,68,.3)}
.cell-label{font-size:.65rem;color:var(--muted);font-weight:600}
.cell-dots{display:flex;gap:3px;flex-wrap:wrap;justify-content:center}
.cell-dot{width:8px;height:8px;border-radius:50%}
.difficulty-bars{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}
.diff-row{display:flex;align-items:center;gap:10px}
.diff-label{font-size:.78rem;font-weight:600;min-width:60px}
.diff-track{flex:1;height:8px;background:var(--border);border-radius:4px;overflow:hidden}
.diff-fill{height:100%;border-radius:4px;transition:width .5s ease}
.diff-val{font-family:'JetBrains Mono',monospace;font-size:.78rem;font-weight:700;min-width:40px;text-align:right}
.error-category{padding:12px 16px;border-radius:10px;margin-bottom:8px;font-size:.85rem;line-height:1.6}
.error-category .error-label{font-weight:700;margin-bottom:4px}
.error-category .error-items{color:var(--muted);font-size:.82rem}

.complete-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 20px;text-align:center}
.complete-icon{font-size:4rem;margin-bottom:16px;animation:celebrateBounce .6s ease}
@keyframes celebrateBounce{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
.complete-screen h1{font-family:'Cormorant Garamond',serif;font-size:clamp(1.8rem,4vw,2.4rem);margin-bottom:8px}
.complete-sub{color:var(--muted);font-size:1rem;margin-bottom:28px}
.takeaway-list{text-align:left;max-width:500px;width:100%;margin-bottom:32px}
.takeaway-item{display:flex;gap:10px;align-items:flex-start;padding:8px 0;font-size:.88rem;color:#ccc}
.takeaway-check{color:var(--correct);flex-shrink:0;font-weight:700}
.nav-cards{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:500px;width:100%}
.nav-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px;text-align:center;cursor:pointer;transition:all .2s;text-decoration:none;color:var(--ink)}
.nav-card:hover{border-color:var(--psda);transform:translateY(-2px)}
.nav-card-label{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.nav-card-title{font-weight:700;font-size:.95rem}

@media(max-width:600px){.mod-meta{flex-wrap:wrap;gap:10px}.fm-grid{grid-template-columns:1fr 1fr}.stat-results{grid-template-columns:1fr 1fr}.classify-opts{gap:4px}.preview-grid{grid-template-columns:1fr 1fr}.welcome-meta{flex-wrap:wrap;gap:12px}.results-grid{grid-template-columns:1fr;gap:1px}.nav-cards{grid-template-columns:1fr}.timer-bar{flex-wrap:wrap;gap:8px}}
</style>
</head>
<body>
<div class="top-stripe"></div>
<div class="screen-progress" id="screenProgress"></div>

<!-- SCREEN 1: WELCOME -->
<div class="screen active fade-in" id="screen-welcome">
  <div class="welcome-screen">
    <div class="welcome-badge">Module 4</div>
    <h1>Problem-Solving & Data Analysis</h1>
    <p class="welcome-sub">Real-world math: ratios, percentages, statistics, probability, and experimental design. ~15% of the PSAT.</p>
    <div class="welcome-meta"><span>‚è± ~60 min</span><span>üìã 4 topics</span><span>üî® 5 exercises</span><span>üéØ 8 practice Qs</span></div>
    <div class="preview-grid">
      <div class="preview-card"><div class="preview-icon">üîÑ</div><div class="preview-title">Retrieval Warm-Up</div><div class="preview-desc">5 questions from Module 3 to activate prior knowledge</div></div>
      <div class="preview-card"><div class="preview-icon">üìä</div><div class="preview-title">4 Core Topics</div><div class="preview-desc">Ratios, statistics, data interpretation, study design</div></div>
      <div class="preview-card"><div class="preview-icon">üéØ</div><div class="preview-title">Trap Taxonomy</div><div class="preview-desc">4 named traps that recur in PSDA problems</div></div>
      <div class="preview-card"><div class="preview-icon">üßÆ</div><div class="preview-title">5 Exercises</div><div class="preview-desc">Ratios, percent traps, two-way tables, statistics, study design</div></div>
      <div class="preview-card"><div class="preview-icon">‚è±</div><div class="preview-title">Timed Practice</div><div class="preview-desc">8 PSAT-style questions with optional timer</div></div>
      <div class="preview-card"><div class="preview-icon">üìà</div><div class="preview-title">Error Analysis</div><div class="preview-desc">Difficulty breakdown + confidence matrix + trap patterns</div></div>
    </div>
    <button class="start-btn" onclick="goScreen(1)">Start Learning ‚Üí</button>
  </div>
</div>

<!-- SCREEN 2: RETRIEVAL WARM-UP -->
<div class="screen" id="screen-warmup">
  <div class="warmup-container">
    <div class="warmup-header">
      <div class="warmup-badge">Retrieval Warm-Up</div>
      <h2 style="font-family:'Cormorant Garamond',serif;font-size:1.6rem">Module 3 Review</h2>
      <p style="color:var(--muted);font-size:.9rem;margin-top:4px">Quick recall from what you learned last time.</p>
      <div class="warmup-dots" id="warmupDots"></div>
    </div>
    <div id="warmupContent"></div>
  </div>
</div>

<!-- SCREEN 3: LESSON CONTENT -->
<div class="screen" id="screen-lesson">
<div class="container">
<a class="back-link" href="index.html">‚Üê Back to PSAT/NMSQT Math Course</a>
<div class="mod-header">
  <div class="mod-badge">Module 4</div>
  <h1>Problem-Solving & Data Analysis</h1>
  <p class="subtitle">Real-world math: ratios, percentages, statistics, probability, and experimental design. ~15% of the PSAT.</p>
  <div class="mod-meta"><span>‚è± ~60 min</span><span>üìã 4 topics</span><span>üî® Phase 2: Build</span></div>
</div>

<div class="callout-yellow callout"><strong>Why This Domain Matters:</strong> These 5‚Äì7 questions are often the most "readable" on the test ‚Äî they're word problems grounded in real-world scenarios. Students who struggle with abstract algebra sometimes <em>thrive</em> here. Accuracy in this domain is very achievable.</div>

<!-- TOPIC 4A -->
<div class="section">
  <div class="section-label">Topic 4A</div>
  <h2>Ratios, Rates & Proportions</h2>
  <div class="fm-grid">
    <div class="fm-card"><div class="fm-name">Proportion</div><div class="fm-eq">a/b = c/d ‚Üí ad = bc</div></div>
    <div class="fm-card"><div class="fm-name">Unit Rate</div><div class="fm-eq">"per" = √∑</div></div>
    <div class="fm-card"><div class="fm-name">Percent</div><div class="fm-eq">part/whole √ó 100</div></div>
    <div class="fm-card"><div class="fm-name">Percent Change</div><div class="fm-eq">(new ‚àí old)/old √ó 100</div></div>
    <div class="fm-card"><div class="fm-name">Percent Increase</div><div class="fm-eq">new = old √ó (1 + r)</div></div>
    <div class="fm-card"><div class="fm-name">Percent Decrease</div><div class="fm-eq">new = old √ó (1 ‚àí r)</div></div>
  </div>
  <div class="topic" onclick="this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Unit Conversion & Dimensional Analysis</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p>Multiply by conversion factors so unwanted units cancel:</p><p><strong>Example:</strong> Convert 60 mph to feet per second:</p><p><code>60 miles/hr √ó 5280 ft/mile √ó 1 hr/3600 sec = 88 ft/sec</code></p><p>Set up fractions so units cancel. Miles cancel with miles, hours cancel with hours.</p><div class="callout"><strong>PSAT Trap:</strong> The question gives data in minutes but asks for hours, or gives miles but asks for feet. Always check the units!</div></div>
  </div>
  <div class="topic" onclick="this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Direct vs. Inverse Proportion</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p><strong>Direct:</strong> y = kx. As x increases, y increases. Doubling x doubles y.</p><p><strong>Inverse:</strong> y = k/x. As x increases, y decreases. Doubling x halves y.</p><p>To identify: if xy is constant ‚Üí inverse. If y/x is constant ‚Üí direct.</p></div>
  </div>
</div>

<!-- EXERCISE 1: RATIO & PERCENT -->
<div class="section">
  <div class="section-label">Interactive Exercise 1</div>
  <h2>Ratio & Percent Problems</h2>
  <p>Solve each problem. Type your numerical answer (no % sign needed).</p>
  <div class="exercise" id="ratioEx"></div>
</div>

<!-- EXERCISE 2: PERCENT TRAP SPOTTER -->
<div class="section">
  <div class="section-label">Interactive Exercise 2</div>
  <h2>Percent Trap Spotter</h2>
  <p>Percent traps are among the most frequently missed questions on the PSAT/NMSQT. Identify the correct answer ‚Äî don't fall for the trap.</p>
  <div class="exercise" style="border-color:var(--psda)" id="pctTrapEx"></div>
</div>

<!-- TOPIC 4B -->
<div class="section">
  <div class="section-label">Topic 4B</div>
  <h2>Statistics: Center, Spread & Shape</h2>
  <div class="topic open" onclick="if(event.target.closest('.topic-body'))return;this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Mean vs. Median ‚Äî When It Matters</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p><strong>Mean</strong> = sum √∑ count. Sensitive to outliers.</p><p><strong>Median</strong> = middle value (sorted). Resistant to outliers.</p><p><strong>The PSAT's favorite question:</strong> "A very high value is added. Which measure changes more?"</p><p>Answer: The <strong>mean</strong> is always more affected. The median barely budges.</p><p><strong>Example:</strong> Data: 10, 12, 14, 15, 16. Mean = 13.4, Median = 14.<br>Add outlier (100): Mean jumps to 27.8. Median only changes to 14.5.</p></div>
  </div>
  <div class="topic" onclick="this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Standard Deviation & Spread</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p><strong>Range</strong> = max ‚àí min. Simplest measure of spread.</p><p><strong>Standard deviation</strong> = how spread out values are from the mean. You don't need to calculate it ‚Äî just understand:</p><ul><li>Clustered tightly ‚Üí SMALL standard deviation</li><li>Spread far apart ‚Üí LARGE standard deviation</li><li>Adding a constant to every value does NOT change standard deviation</li><li>Multiplying every value by a constant DOES change it (by that factor)</li></ul></div>
  </div>
  <div class="topic" onclick="this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Distribution Shape & Skew</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p><strong>Symmetric:</strong> Mean ‚âà Median. Bell-shaped.</p><p><strong>Skewed right (positive):</strong> Tail goes right. Mean &gt; Median. (High outliers pull mean up.)</p><p><strong>Skewed left (negative):</strong> Tail goes left. Mean &lt; Median. (Low outliers pull mean down.)</p><p><strong>Tip:</strong> "Which direction is the skew?" ‚Üí look for the long tail.</p></div>
  </div>
</div>

<!-- STATISTICS EXPLORER -->
<div class="section">
  <div class="section-label">Interactive Tool</div>
  <h2>Statistics Explorer</h2>
  <p>Enter comma-separated numbers to see mean, median, range, and count instantly. Try adding an outlier!</p>
  <div class="stat-exp">
    <input class="stat-input" id="statInput" value="12, 15, 18, 20, 22, 25, 28" placeholder="Enter numbers separated by commas‚Ä¶" oninput="calcStats()">
    <div class="stat-results" id="statResults"></div>
    <div id="statInsight" style="margin-top:10px;font-size:.85rem;color:var(--muted)"></div>
  </div>
</div>

<!-- TOPIC 4C -->
<div class="section">
  <div class="section-label">Topic 4C</div>
  <h2>Data Interpretation & Scatterplots</h2>
  <div class="topic open" onclick="if(event.target.closest('.topic-body'))return;this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Scatterplots & Line of Best Fit</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p><strong>Correlation:</strong> Positive (both increase ‚Üó), Negative (one up, other down ‚Üò), None (random).</p><p><strong>Line of best fit:</strong> Slope = rate of change in context. Y-intercept = predicted value when x = 0.</p><p><strong>Interpolation</strong> = predicting WITHIN data range (reliable).</p><p><strong>Extrapolation</strong> = predicting BEYOND data range (unreliable).</p><p><strong>Residuals</strong> = actual ‚àí predicted. Good model: residuals scattered randomly around zero. Pattern in residuals ‚Üí bad model fit.</p></div>
  </div>
  <div class="topic" onclick="this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Two-Way Frequency Tables</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p><strong>Marginal frequencies:</strong> Row/column totals.</p><p><strong>Joint frequencies:</strong> Values inside the table.</p><p><strong>Conditional probability:</strong> P(A|B) = "given B, what's the probability of A?"</p><p>Formula: P(A|B) = (count of A AND B) / (total count of B)</p><div class="callout"><strong>PSAT Trap:</strong> Confusing P(A|B) with P(B|A). "Given they play sports, probability of having a job" is NOT the same as "given they have a job, probability of playing sports." The denominator changes!</div></div>
  </div>
  <div class="callout-blue callout"><strong>Desmos Regression:</strong> Enter data as a table, then type <code>y‚ÇÅ ~ mx‚ÇÅ + b</code> for linear or <code>y‚ÇÅ ~ ax‚ÇÅ¬≤ + bx‚ÇÅ + c</code> for quadratic. Desmos finds the best-fit equation automatically.</div>
</div>

<!-- EXERCISE 3: TWO-WAY TABLE -->
<div class="section">
  <div class="section-label">Interactive Exercise 3</div>
  <h2>Two-Way Table & Probability</h2>
  <p>Use the table below to answer probability questions.</p>
  <div class="exercise">
    <h3>üìä Student Activity Survey</h3>
    <div class="exercise-sub">200 students were surveyed about extracurricular activities.</div>
    <table class="data-table">
      <tr><th></th><th>Plays Sport</th><th>No Sport</th><th>Total</th></tr>
      <tr><td style="font-weight:700;text-align:left">Has a Job</td><td>45</td><td>35</td><td class="highlight">80</td></tr>
      <tr><td style="font-weight:700;text-align:left">No Job</td><td>55</td><td>65</td><td class="highlight">120</td></tr>
      <tr><td style="font-weight:700;text-align:left">Total</td><td class="highlight">100</td><td class="highlight">100</td><td class="highlight">200</td></tr>
    </table>
    <div id="tableQs"></div>
  </div>
</div>

<!-- EXERCISE 4: MISLEADING STATISTICS -->
<div class="section">
  <div class="section-label">Interactive Exercise 4</div>
  <h2>Spot the Misleading Statistic</h2>
  <p>The PSAT tests whether you can identify flaws in statistical reasoning. For each claim, identify why it's misleading or invalid.</p>
  <div class="exercise" style="border-color:var(--accent)" id="misleadEx"></div>
</div>

<!-- TOPIC 4D -->
<div class="section">
  <div class="section-label">Topic 4D</div>
  <h2>Probability & Study Design</h2>
  <div class="topic open" onclick="if(event.target.closest('.topic-body'))return;this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Probability Basics</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p><strong>P(event) = favorable outcomes / total outcomes</strong></p><p>Always between 0 (impossible) and 1 (certain).</p><p><strong>Complement:</strong> P(not A) = 1 ‚àí P(A)</p><p><strong>"At least one"</strong> problems: P(at least one) = 1 ‚àí P(none). This is almost always easier than counting directly.</p></div>
  </div>
  <div class="topic" onclick="this.classList.toggle('open')">
    <div class="topic-header"><div class="topic-title">Study Design ‚Äî The PSAT's Favorite Trick</div><div class="topic-arrow">‚ñ∏</div></div>
    <div class="topic-body"><p>Three key rules for what conclusions are valid:</p><ul><li><strong>Random sampling</strong> ‚Üí can generalize to the population</li><li><strong>Random assignment to groups</strong> ‚Üí can establish causation (this makes it an experiment)</li><li><strong>No random assignment</strong> ‚Üí correlation only, NOT causation</li></ul><p><strong>Confounding variables:</strong> Other factors that could explain the result. "Students who eat breakfast score higher" ‚Äî is it breakfast, or are they more organized generally?</p><p><strong>Margin of error:</strong> Larger sample ‚Üí smaller margin of error. That's the whole concept for the PSAT.</p></div>
  </div>
</div>

<!-- EXERCISE 5: STUDY DESIGN -->
<div class="section">
  <div class="section-label">Interactive Exercise 5</div>
  <h2>Study Design Classifier</h2>
  <p>For each scenario, decide what valid conclusions can be drawn.</p>
  <div class="exercise" style="border-color:var(--advanced)" id="studyEx"></div>
</div>

<!-- TRAP TAXONOMY -->
<div class="section">
  <div class="section-label">Math Trap Taxonomy</div>
  <h2>Four Traps That Recur in PSDA</h2>
  <p>Learn these by name. When you spot one in a problem, you'll know exactly what to watch for.</p>
  <div class="trap-taxonomy">
    <div class="trap-card"><div class="trap-number" style="background:var(--psda)">1</div><div class="trap-card-body"><div class="trap-card-name">üåÄ The Percent Spiral</div><div class="trap-card-desc">Successive percent changes don't cancel. A 10% increase then 10% decrease leaves you 1% below the original.</div><div class="trap-card-example">$100 ‚Üí +10% = $110 ‚Üí ‚àí10% = $99 (not $100)</div></div></div>
    <div class="trap-card"><div class="trap-number" style="background:var(--wrong)">2</div><div class="trap-card-body"><div class="trap-card-name">üéØ The Wrong Target</div><div class="trap-card-desc">Used the wrong denominator in a percentage. Percent change divides by OLD value. Percent "of" divides by the whole.</div><div class="trap-card-example">$80 ‚Üí $100: change = 20/80 = 25% (not 20/100 = 20%)</div></div></div>
    <div class="trap-card"><div class="trap-number" style="background:var(--math)">3</div><div class="trap-card-body"><div class="trap-card-name">üìä The Scale Mirage</div><div class="trap-card-desc">Misreading graph axes ‚Äî a bar chart with a truncated y-axis makes small differences look huge.</div><div class="trap-card-example">Y-axis starts at 90 instead of 0 ‚Üí a difference of 5 looks enormous</div></div></div>
    <div class="trap-card"><div class="trap-number" style="background:var(--advanced)">4</div><div class="trap-card-body"><div class="trap-card-name">üîÄ The Conditional Swap</div><div class="trap-card-desc">Confusing P(A|B) with P(B|A). The denominator changes depending on which condition you're "given."</div><div class="trap-card-example">P(job|sport) = 45/100 ‚â† P(sport|job) = 45/80</div></div></div>
  </div>
</div>

<div style="text-align:center;padding:24px 0">
  <button class="start-btn" onclick="goScreen(3)">Continue to Practice Questions ‚Üí</button>
</div>
</div>
</div>

<!-- SCREEN 4: TIMED PRACTICE -->
<div class="screen" id="screen-practice">
<div class="container">
  <div class="section-label">PSAT/NMSQT Practice</div>
  <h2 style="font-family:'Cormorant Garamond',serif;font-size:1.6rem;margin-bottom:4px">Practice Questions</h2>
  <p style="color:var(--muted);font-size:.9rem;margin-bottom:16px">8 questions at three difficulty tiers. Tag your confidence before answering.</p>
  <div class="timer-bar" id="timerBar">
    <div class="timer-display" id="timerDisplay">--:--</div>
    <div class="timer-track"><div class="timer-fill" id="timerFill"></div></div>
    <div class="q-dots" id="qDots"></div>
    <button class="timer-toggle" id="timerToggle" onclick="toggleTimer()">‚è± Timer OFF</button>
  </div>
  <div id="psatPractice"></div>
  <div id="practiceResults" style="display:none"></div>
  <div id="practiceNav" style="display:none;text-align:center;padding:24px 0">
    <button class="start-btn" onclick="goScreen(4)">View Summary & Complete Module ‚Üí</button>
  </div>
</div>
</div>

<!-- SCREEN 5: MODULE COMPLETE -->
<div class="screen" id="screen-complete">
  <div class="complete-screen">
    <div class="complete-icon">üéâ</div>
    <h1>Module 4 Complete!</h1>
    <p class="complete-sub">You've mastered Problem-Solving & Data Analysis.</p>
    <div class="takeaway-list">
      <div style="font-weight:700;margin-bottom:12px;font-size:.85rem;color:var(--psda);text-transform:uppercase;letter-spacing:1px">Key Takeaways</div>
      <div class="takeaway-item"><span class="takeaway-check">‚úì</span> Percent change = (new ‚àí old) / <strong>old</strong> √ó 100. The OLD value is always the denominator.</div>
      <div class="takeaway-item"><span class="takeaway-check">‚úì</span> Mean is sensitive to outliers; median is resistant. The PSAT tests this constantly.</div>
      <div class="takeaway-item"><span class="takeaway-check">‚úì</span> On scatterplots, slope = rate of change in context. Y-intercept = starting value.</div>
      <div class="takeaway-item"><span class="takeaway-check">‚úì</span> Conditional probability: P(A|B) = (A and B) / (total B). The denominator changes based on the "given."</div>
      <div class="takeaway-item"><span class="takeaway-check">‚úì</span> Only <strong>experiments with random assignment</strong> can establish causation. Everything else is correlation.</div>
      <div class="takeaway-item"><span class="takeaway-check">‚úì</span> Larger sample size ‚Üí smaller margin of error.</div>
      <div class="takeaway-item"><span class="takeaway-check">‚úì</span> A 10% increase followed by a 10% decrease does NOT return to the original ‚Äî it's 1% less.</div>
    </div>
    <div id="completePracticeStats"></div>
    <div class="nav-cards">
      <a class="nav-card" href="module-3.html"><div class="nav-card-label">‚Üê Previous</div><div class="nav-card-title">Module 3: Advanced Math</div></a>
      <a class="nav-card" href="module-5.html" style="border-color:var(--psda)"><div class="nav-card-label">Next ‚Üí</div><div class="nav-card-title">Module 5: Geometry & Trig</div></a>
    </div>
  </div>
</div>

<script>
// SCREEN NAVIGATION
const SCREENS=['screen-welcome','screen-warmup','screen-lesson','screen-practice','screen-complete'];
let currentScreen=0;
function goScreen(idx){
  if(idx<0||idx>=SCREENS.length)return;
  const cur=document.getElementById(SCREENS[currentScreen]),nxt=document.getElementById(SCREENS[idx]);
  cur.classList.remove('fade-in');cur.classList.add('fade-out');
  setTimeout(()=>{cur.classList.remove('active','fade-out');nxt.classList.add('active','fade-in');currentScreen=idx;updateProgressDots();window.scrollTo(0,0);if(idx===3&&timerEnabled)startTimer();},300);
}
function updateProgressDots(){
  document.getElementById('screenProgress').innerHTML=SCREENS.map((s,i)=>{let cls='screen-dot';if(i<currentScreen)cls+=' completed';if(i===currentScreen)cls+=' current';return `<div class="${cls}" onclick="${i<=currentScreen?'goScreen('+i+')':''}" title="${['Welcome','Warm-Up','Lesson','Practice','Complete'][i]}"></div>`;}).join('');
}
updateProgressDots();

// WARM-UP (Module 3 content)
const WARMUP_QS=[
  {source:'Module 3 ‚Äî Quadratics',q:'What are the three quadratic forms?',
   ch:['Standard, Factored, Vertex','Linear, Quadratic, Cubic','Standard, Slope-Intercept, Point-Slope','Expanded, Simplified, Reduced'],c:0,
   fb:'The three forms are Standard (ax¬≤+bx+c), Factored (a(x‚àír)(x‚àís)), and Vertex (a(x‚àíh)¬≤+k).'},
  {source:'Module 3 ‚Äî Discriminant',q:'If the discriminant b¬≤‚àí4ac is negative, how many real solutions does the quadratic have?',
   ch:['Two','One','Zero','Cannot determine'],c:2,
   fb:'Negative discriminant means no real solutions ‚Äî the parabola doesn\'t cross the x-axis.'},
  {source:'Module 3 ‚Äî Vertex',q:'For f(x) = 2x¬≤ ‚àí 8x + 3, the x-coordinate of the vertex is:',
   ch:['x = 4','x = 2','x = ‚àí2','x = 8'],c:1,
   fb:'Vertex x = ‚àíb/2a = ‚àí(‚àí8)/2(2) = 8/4 = 2.'},
  {source:'Module 3 ‚Äî Exponents',q:'What is 8^(2/3)?',
   ch:['4','6','2','16'],c:0,
   fb:'8^(2/3) = (‚àõ8)¬≤ = 2¬≤ = 4. Take the cube root first, then square.'},
  {source:'Module 3 ‚Äî Growth/Decay',q:'A function f(x) = 500(0.92)À£ represents:',
   ch:['Linear growth','Exponential growth','Exponential decay','Linear decay'],c:2,
   fb:'The base 0.92 is between 0 and 1, so this is exponential decay (losing 8% per period).'}
];
let warmupIdx=0,warmupAnswers=[],warmupAnswered=false;
function renderWarmup(){
  document.getElementById('warmupDots').innerHTML=WARMUP_QS.map((_,i)=>{let cls='warmup-dot';if(i<warmupIdx)cls+=warmupAnswers[i]?' done-correct':' done-wrong';if(i===warmupIdx&&warmupIdx<WARMUP_QS.length)cls+=' active';return `<div class="${cls}"></div>`;}).join('');
  const cont=document.getElementById('warmupContent');
  if(warmupIdx>=WARMUP_QS.length){const cor=warmupAnswers.filter(Boolean).length;cont.innerHTML=`<div class="warmup-summary"><div class="warmup-badge">Warm-Up Complete</div><div class="warmup-score">${cor} / ${WARMUP_QS.length}</div><p style="color:var(--muted);font-size:.9rem;margin-bottom:8px">${cor===5?'Perfect recall! Module 3 knowledge is locked in.':cor>=3?'Good recall! A couple topics to revisit.':'Some gaps from Module 3 ‚Äî consider a quick review.'}</p><button class="warmup-continue" onclick="goScreen(2)">Continue to Lesson ‚Üí</button></div>`;return;}
  const q=WARMUP_QS[warmupIdx];warmupAnswered=false;
  cont.innerHTML=`<div class="warmup-q"><div class="source-tag">From ${q.source}</div><div class="q-text">${q.q}</div><div class="warmup-choices" id="warmupChoices">${q.ch.map((ch,ci)=>`<div class="warmup-choice" onclick="answerWarmup(${ci})">${ch}</div>`).join('')}</div><div id="warmupFb" style="display:none"></div></div>`;
}
function answerWarmup(ci){
  if(warmupAnswered)return;warmupAnswered=true;
  const q=WARMUP_QS[warmupIdx],correct=ci===q.c;warmupAnswers.push(correct);
  document.querySelectorAll('.warmup-choice').forEach((ch,i)=>{ch.classList.add('wu-dis');if(i===q.c)ch.classList.add('wu-correct');else if(i===ci&&!correct)ch.classList.add('wu-wrong');});
  const fb=document.getElementById('warmupFb');fb.style.display='block';
  fb.innerHTML=`<div class="warmup-fb">${correct?'‚úì ':'‚úó '}${q.fb}</div><button class="warmup-next" onclick="warmupIdx++;renderWarmup()">${warmupIdx<WARMUP_QS.length-1?'Next Question ‚Üí':'See Results ‚Üí'}</button>`;
  document.getElementById('warmupDots').innerHTML=WARMUP_QS.map((_,i)=>{let cls='warmup-dot';if(i<warmupAnswers.length)cls+=warmupAnswers[i]?' done-correct':' done-wrong';else if(i===warmupIdx+1)cls+=' active';return `<div class="${cls}"></div>`;}).join('');
}
renderWarmup();

// HELPERS
function mkScore(id,correct,total){return `<div class="score-bar"><div class="score-bar-label">Score</div><div class="score-bar-track"><div class="score-bar-fill" style="width:${total?correct/total*100:0}%"></div></div><div class="score-bar-val">${correct}/${total}</div></div>`;}

// EXERCISE 1: RATIO & PERCENT
const RATIO_QS=[
  {prompt:'A store marks up a $40 item by 25%. What is the selling price?',answer:50,solution:'$40 √ó 1.25 = $50. Or: 25% of 40 = 10, so 40 + 10 = 50.'},
  {prompt:'A shirt was $80, now $60. What is the percent decrease?',answer:25,solution:'(80 ‚àí 60)/80 √ó 100 = 20/80 √ó 100 = 25%. Remember: divide by the OLD value.'},
  {prompt:'If 3 workers paint a house in 12 hours, how many hours for 4 workers? (Inverse proportion)',answer:9,solution:'workers √ó hours = constant. 3 √ó 12 = 36. So 4 √ó h = 36, h = 9.'},
  {prompt:'A recipe for 6 servings uses 2 cups of flour. How many cups for 15 servings?',answer:5,solution:'2/6 = x/15. Cross multiply: 6x = 30, x = 5 cups.'},
  {prompt:'A car travels 240 miles on 8 gallons. Miles per gallon?',answer:30,solution:'Unit rate: 240 √∑ 8 = 30 mpg.'},
  {prompt:'A population grows from 5,000 to 6,500. What is the percent increase?',answer:30,solution:'(6500 ‚àí 5000)/5000 √ó 100 = 1500/5000 √ó 100 = 30%.'},
];
function renderRatios(){
  document.getElementById('ratioEx').innerHTML=`<h3>üìè Ratios & Percentages</h3><div class="exercise-sub">Type your numerical answer (no % sign).</div>`+
    RATIO_QS.map((q,i)=>`<div class="ex-item"><div class="ex-prompt">${q.prompt}</div><div class="ex-input-row"><input class="ex-input" type="number" step="any" id="rInp${i}" placeholder="?" onkeydown="if(event.key==='Enter')checkRatio(${i})"><button class="ex-btn" onclick="checkRatio(${i})">Check</button></div><div class="ex-fb" id="rFb${i}"></div></div>`).join('');
}
function checkRatio(i){
  const v=parseFloat(document.getElementById('rInp'+i).value),fb=document.getElementById('rFb'+i);
  if(isNaN(v)){fb.className='ex-fb show wrong';fb.textContent='Enter a number.';return;}
  if(Math.abs(v-RATIO_QS[i].answer)<0.1){fb.className='ex-fb show correct';fb.textContent='‚úì Correct! '+RATIO_QS[i].solution;}
  else{fb.className='ex-fb show wrong';fb.textContent='‚úó Not quite. '+RATIO_QS[i].solution;}
}
renderRatios();

// EXERCISE 2: PERCENT TRAP SPOTTER
var PCT_QS=[
  {q:'A price goes up 20%, then down 20%. Is the final price equal to the original?',opts:['Yes, they cancel out','No, it\'s 4% less','No, it\'s 4% more','Depends on the price'],c:1,fb:'Start $100: +20% = $120. ‚àí20% of $120 = $24 off = $96. That\'s 4% less. The second percent applies to the NEW amount.'},
  {q:'A store advertises "50% off, then an additional 20% off." Is that the same as 70% off?',opts:['Yes, 50+20=70','No, it\'s only 60% off total','No, it\'s 56% off total','Depends on original price'],c:1,fb:'Start $100: 50% off = $50. Then 20% off $50 = $10 off = $40. Total discount = 60%, not 70%.'},
  {q:'"Sales increased 200%." If original sales were $1,000, what are they now?',opts:['$2,000','$3,000','$200,000','$1,200'],c:1,fb:'200% INCREASE means the increase is $2,000. New total = $1,000 + $2,000 = $3,000. A 200% increase triples the original.'},
  {q:'A student got 80% on Test 1 and 90% on Test 2. Is their overall average 85%?',opts:['Yes, always','Only if both tests have the same number of questions','Only if Test 2 was harder','Never'],c:1,fb:'Only if tests have equal weight (same number of questions/points). If Test 1 had 50 Qs and Test 2 had 10, the average is much closer to 80%.'},
  {q:'A town\'s population drops 10% one year, then grows 10% the next. Is it back to the original?',opts:['Yes, they cancel out','No, it\'s 1% less','No, it\'s 1% more','Depends on the population'],c:1,fb:'Start 1000: ‚àí10% = 900. +10% of 900 = 90 = 990. That\'s 1% less. Successive percent changes NEVER cancel.'},
];
var pctA={};
function renderPct(){
  document.getElementById('pctTrapEx').innerHTML='<h3>üéØ Percent Traps</h3><div class="exercise-sub">Identify the correct answer ‚Äî these are the traps PSAT loves.</div>'+
    PCT_QS.map(function(q,i){var a=pctA[i],h=a!==undefined;
      return '<div class="ex-item"><div class="ex-prompt">'+q.q+'</div><div class="classify-opts">'+q.opts.map(function(o,oi){var c='classify-opt';if(h){c+=' cl-dis';if(oi===q.c)c+=' cl-correct';else if(oi===a)c+=' cl-wrong';}return '<div class="'+c+'" onclick="aPct('+i+','+oi+')">'+o+'</div>';}).join('')+'</div><div class="ex-fb'+(h?' show':'')+(h?(a===q.c?' correct':' wrong'):'')+'">'+((h)?((a===q.c?'\u2713 ':'\u2717 ')+q.fb):'')+'</div></div>';
    }).join('');
}
function aPct(i,v){if(pctA[i]!==undefined)return;pctA[i]=v;renderPct();}
renderPct();

// STATISTICS EXPLORER
function calcStats(){
  const raw=document.getElementById('statInput').value;
  const nums=raw.split(',').map(s=>parseFloat(s.trim())).filter(n=>!isNaN(n));
  if(!nums.length){document.getElementById('statResults').innerHTML='';document.getElementById('statInsight').innerHTML='';return;}
  const sorted=[...nums].sort((a,b)=>a-b);
  const n=nums.length,sum=nums.reduce((a,b)=>a+b,0),mean=sum/n;
  const median=n%2===1?sorted[Math.floor(n/2)]:(sorted[n/2-1]+sorted[n/2])/2;
  const range=sorted[n-1]-sorted[0];
  document.getElementById('statResults').innerHTML=[
    {label:'Count',val:n,color:'var(--ink)'},{label:'Mean',val:+(mean.toFixed(2)),color:'var(--psda)'},
    {label:'Median',val:+(median.toFixed(2)),color:'var(--algebra)'},{label:'Range',val:+(range.toFixed(2)),color:'var(--geotrig)'},
    {label:'Min',val:sorted[0],color:'var(--muted)'},{label:'Max',val:sorted[n-1],color:'var(--muted)'},
  ].map(s=>`<div class="stat-result"><div class="stat-val" style="color:${s.color}">${s.val}</div><div class="stat-label">${s.label}</div></div>`).join('');
  let insight='';
  if(Math.abs(mean-median)>range*0.15)insight=mean>median?'‚ö†Ô∏è Mean > Median ‚Üí <strong>skewed right</strong> (high values pulling mean up).':'‚ö†Ô∏è Mean < Median ‚Üí <strong>skewed left</strong> (low values pulling mean down).';
  else insight='‚úì Mean ‚âà Median ‚Üí roughly <strong>symmetric</strong> distribution.';
  document.getElementById('statInsight').innerHTML=insight;
}
calcStats();

// TWO-WAY TABLE
const TABLE_QS=[
  {q:'What proportion of ALL students play a sport?',opts:['100/200 = 0.50','45/200 = 0.225','100/80 = 1.25','55/200 = 0.275'],correct:0,fb:'Total who play sport = 100. Total students = 200. P = 100/200 = 0.50 (50%).'},
  {q:'What is P(has a job | plays a sport)?',opts:['45/200 = 0.225','45/100 = 0.45','45/80 = 0.5625','80/200 = 0.40'],correct:1,fb:'Given "plays a sport" ‚Üí denominator is 100 (sport total). Of those, 45 have a job. P = 45/100 = 0.45.'},
  {q:'What is P(plays a sport | has a job)?',opts:['45/100 = 0.45','45/200 = 0.225','45/80 = 0.5625','80/100 = 0.80'],correct:2,fb:'Given "has a job" ‚Üí denominator is 80 (job total). Of those, 45 play a sport. P = 45/80 = 0.5625. Notice this is DIFFERENT from the previous question!'},
  {q:'What fraction of non-sport students have a job?',opts:['35/200 = 0.175','35/100 = 0.35','65/100 = 0.65','35/80 = 0.4375'],correct:1,fb:'Non-sport column total = 100. Of those, 35 have a job. P = 35/100 = 0.35.'},
  {q:'Are "plays a sport" and "has a job" independent events?',opts:['Yes ‚Äî both columns total 100','No ‚Äî P(job|sport) ‚â† P(job)','Yes ‚Äî the probabilities are equal','Cannot determine'],correct:1,fb:'P(job) = 80/200 = 0.40. P(job|sport) = 45/100 = 0.45. Since 0.40 ‚â† 0.45, NOT independent.'},
];
let tableAns={};
function renderTable(){
  const total=TABLE_QS.length;const correct=Object.entries(tableAns).filter(([i,v])=>v===TABLE_QS[i].correct).length;
  document.getElementById('tableQs').innerHTML=TABLE_QS.map((q,i)=>{
    const a=tableAns[i];const has=a!==undefined;
    return `<div class="ex-item"><div class="ex-prompt">${q.q}</div><div class="classify-opts">${q.opts.map((o,oi)=>{let cls='classify-opt';if(has){cls+=' cl-dis';if(oi===q.correct)cls+=' cl-correct';else if(oi===a&&oi!==q.correct)cls+=' cl-wrong';}return `<div class="${cls}" onclick="ansTable(${i},${oi})">${o}</div>`;}).join('')}</div><div class="ex-fb${has?' show':''}${has?(a===q.correct?' correct':' wrong'):''}">${has?(a===q.correct?'‚úì Correct! ':'‚úó Incorrect. ')+q.fb:''}</div></div>`;
  }).join('')+mkScore('t',correct,total);
}
function ansTable(i,v){if(tableAns[i]!==undefined)return;tableAns[i]=v;renderTable();}
renderTable();

// MISLEADING STATISTICS
const MISLEAD_QS=[
  {claim:'"Our product increased sales by 200%!" (Sales went from 1 unit to 3 units.)',opts:['The percentage is mathematically wrong','Small sample ‚Äî 200% of almost nothing','The time period is too short','No issue ‚Äî the claim is valid'],correct:1,fb:'200% increase on 1 unit = 3 units. Technically correct, but deeply misleading. A 200% increase sounds impressive but the absolute numbers are tiny.'},
  {claim:'"90% of dentists recommend our toothpaste." (Only 10 dentists were surveyed.)',opts:['The percentage is wrong','Sample size too small to generalize','Dentists are biased','Survey is valid'],correct:1,fb:'9 out of 10 is 90%, but with only 10 dentists the margin of error is enormous. You can\'t generalize from such a tiny sample.'},
  {claim:'"Students who use our app score 50 points higher on the PSAT." (Students self-selected to use the app.)',opts:['No random assignment ‚Äî could be self-selection bias','The 50-point difference is too small','The app doesn\'t cover all domains','Sample size issue'],correct:0,fb:'Students who choose to use a study app are probably already more motivated. Without random assignment, you can\'t say the app <em>caused</em> the improvement.'},
  {claim:'"The average household income in our town is $180,000." (A few billionaires live there.)',opts:['The calculation is wrong','Should use median instead of mean','Sample is too small','Income data is unreliable'],correct:1,fb:'A few extremely high incomes skew the mean dramatically upward. The median would be much more representative.'},
  {claim:'"Crime has doubled in the past year!" (Went from 2 incidents to 4 in a town of 50,000.)',opts:['The percentage is wrong','Small absolute numbers make % misleading','Time period is wrong','Crime data is unreliable'],correct:1,fb:'From 2 to 4 is technically a 100% increase, but in a town of 50,000, these are negligibly small numbers.'},
];
let misleadAns={};
function renderMislead(){
  const total=MISLEAD_QS.length;const correct=Object.entries(misleadAns).filter(([i,v])=>v===MISLEAD_QS[i].correct).length;
  document.getElementById('misleadEx').innerHTML=`<h3>üîç Find the Flaw</h3><div class="exercise-sub">Each claim uses statistics in a misleading way. Identify the problem.</div>`+
    MISLEAD_QS.map((q,i)=>{const a=misleadAns[i];const has=a!==undefined;
      return `<div class="ex-item"><div class="ex-prompt" style="font-style:italic">${q.claim}</div><div class="classify-opts">${q.opts.map((o,oi)=>{let cls='classify-opt';if(has){cls+=' cl-dis';if(oi===q.correct)cls+=' cl-correct';else if(oi===a&&oi!==q.correct)cls+=' cl-wrong';}return `<div class="${cls}" onclick="ansMislead(${i},${oi})">${o}</div>`;}).join('')}</div><div class="ex-fb${has?' show':''}${has?(a===q.correct?' correct':' wrong'):''}">${has?(a===q.correct?'‚úì ':'‚úó ')+q.fb:''}</div></div>`;
    }).join('')+mkScore('m',correct,total);
}
function ansMislead(i,v){if(misleadAns[i]!==undefined)return;misleadAns[i]=v;renderMislead();}
renderMislead();

// STUDY DESIGN CLASSIFIER
const STUDY_QS=[
  {scenario:'Researchers randomly selected 500 adults from a city and found that those who exercised regularly had lower blood pressure.',opts:['Causation ‚Äî exercise lowers blood pressure','Association ‚Äî can generalize to city','Association ‚Äî cannot generalize','No valid conclusion'],correct:1,fb:'Random sampling ‚Üí can generalize. No random assignment ‚Üí association only, not causation.'},
  {scenario:'100 volunteers were randomly assigned to drink green tea or water daily for 3 months. The tea group showed improved focus.',opts:['Causation ‚Äî can generalize to all adults','Causation ‚Äî but only for volunteers','Association ‚Äî can generalize','Association ‚Äî cannot generalize'],correct:1,fb:'Random assignment ‚Üí causation. But volunteers (not random sample) ‚Üí can\'t generalize beyond these participants.'},
  {scenario:'A researcher surveys students at her school and finds a correlation between screen time and lower grades.',opts:['Causation ‚Äî screens lower grades','Association ‚Äî can generalize','Association ‚Äî cannot generalize','Causation ‚Äî but only for this school'],correct:2,fb:'No random assignment ‚Üí no causation. No random sampling (just one school) ‚Üí can\'t generalize.'},
  {scenario:'A national organization randomly selects 10,000 people and randomly assigns half to take Vitamin D. After 1 year, the supplement group has fewer colds.',opts:['Causation ‚Äî can generalize','Association ‚Äî can generalize','Causation ‚Äî only for sample','Association ‚Äî cannot generalize'],correct:0,fb:'Random sampling AND random assignment ‚Üí causation AND generalizability. This is the gold standard.'},
  {scenario:'Countries with more chocolate consumption per capita have more Nobel Prize winners.',opts:['Causation ‚Äî chocolate helps','Correlation ‚Äî confounding variables likely','Causation ‚Äî can generalize','Association ‚Äî can generalize'],correct:1,fb:'Wealth is a confounding variable ‚Äî wealthier countries have both more chocolate and more Nobel winners.'},
  {scenario:'To reduce margin of error from ¬±5% to ¬±2.5%, a researcher should:',opts:['Increase sample size','Use different polling method','Ask more questions','Survey different population'],correct:0,fb:'Larger sample ‚Üí smaller margin of error. To halve margin of error, quadruple sample size.'},
];
let studyAns={};
function renderStudy(){
  const total=STUDY_QS.length;const correct=Object.entries(studyAns).filter(([i,v])=>v===STUDY_QS[i].correct).length;
  document.getElementById('studyEx').innerHTML=`<h3>üî¨ Study Design Classifier</h3><div class="exercise-sub">What conclusions are valid?</div>`+
    STUDY_QS.map((q,i)=>{const a=studyAns[i];const has=a!==undefined;
      return `<div class="ex-item"><div class="ex-prompt">${q.scenario}</div><div class="classify-opts">${q.opts.map((o,oi)=>{let cls='classify-opt';if(has){cls+=' cl-dis';if(oi===q.correct)cls+=' cl-correct';else if(oi===a&&oi!==q.correct)cls+=' cl-wrong';}return `<div class="${cls}" onclick="ansStudy(${i},${oi})">${o}</div>`;}).join('')}</div><div class="ex-fb${has?' show':''}${has?(a===q.correct?' correct':' wrong'):''}">${has?(a===q.correct?'‚úì ':'‚úó ')+q.fb:''}</div></div>`;
    }).join('')+mkScore('s',correct,total);
}
function ansStudy(i,v){if(studyAns[i]!==undefined)return;studyAns[i]=v;renderStudy();}
renderStudy();

// TIMED PRACTICE
const PST=[
  {t:1,tp:'4A',q:'If 40% of 250 students passed an exam, how many students passed?',ch:['40','80','100','160'],c:2,fb:'40% of 250 = 0.40 √ó 250 = 100 students.',
   trap:null,trapAnswer:0,trapDesc:'Confused the percent with the count'},
  {t:1,tp:'4B',q:'Data set: 3, 5, 7, 9, 11. What is the mean?',ch:['5','7','9','35'],c:1,fb:'Mean = (3+5+7+9+11)/5 = 35/5 = 7.',
   trap:'wrong_target',trapAnswer:3,trapDesc:'Gave the sum instead of the mean ‚Äî The Wrong Target'},
  {t:1,tp:'4D',q:'A bag contains 4 red, 6 blue, and 10 green marbles. What is the probability of drawing a blue marble?',ch:['6/20 = 0.30','6/10 = 0.60','6/4 = 1.50','6/16 = 0.375'],c:0,fb:'Total marbles = 4+6+10 = 20. P(blue) = 6/20 = 0.30.',
   trap:'wrong_target',trapAnswer:3,trapDesc:'Used wrong total (forgot one color) ‚Äî The Wrong Target'},
  {t:2,tp:'4A',q:'A jacket costs $120 after a 20% discount. What was the original price?',ch:['$96','$140','$144','$150'],c:3,fb:'After 20% off, you pay 80%. So 0.80 √ó original = 120 ‚Üí original = $150.',
   trap:'percent_spiral',trapAnswer:2,trapDesc:'Added 20% to sale price instead of dividing ‚Äî Percent Spiral'},
  {t:2,tp:'4C',q:'A scatterplot shows the line of best fit: <code>y = 2.5x + 15</code>, where x = hours studied and y = test score. What does 2.5 represent?',ch:['The minimum score','The score when x = 0','The predicted score increase per hour','The total hours studied'],c:2,fb:'Slope = rate of change. Each additional hour predicts a 2.5-point score increase.',
   trap:null,trapAnswer:1,trapDesc:'Confused slope with y-intercept'},
  {t:2,tp:'4B',q:'A data set has mean 50 and median 45. The distribution is most likely:',ch:['Symmetric','Skewed left','Skewed right','Bimodal'],c:2,fb:'Mean > Median ‚Üí skewed right. High values pull the mean above the median.',
   trap:'conditional_swap',trapAnswer:1,trapDesc:'Reversed the skew direction ‚Äî Conditional Swap on mean vs median'},
  {t:3,tp:'4A',q:'A store raises prices 10%, then offers a 10% discount. Compared to the original, the final price is:',ch:['The same','1% less','1% more','10% less'],c:1,fb:'Start $100 ‚Üí +10% = $110 ‚Üí ‚àí10% of $110 = $99. That\'s 1% less.',
   trap:'percent_spiral',trapAnswer:0,trapDesc:'Assumed successive percent changes cancel ‚Äî The Percent Spiral'},
  {t:3,tp:'4C',q:'A two-way table shows P(A|B) = 0.6 and P(A) = 0.4. Events A and B are:',ch:['Independent','Not independent','Mutually exclusive','Complementary'],c:1,fb:'If independent, P(A|B) would equal P(A). Since 0.6 ‚â† 0.4, they are NOT independent.',
   trap:'conditional_swap',trapAnswer:0,trapDesc:'Assumed conditional equals marginal ‚Äî The Conditional Swap'},
];

const TRAP_NAMES={'percent_spiral':'üåÄ Percent Spiral','wrong_target':'üéØ Wrong Target','scale_mirage':'üìä Scale Mirage','conditional_swap':'üîÄ Conditional Swap'};

let pstA={},pstConf={},pstTime={},pstStartTime=null;
let timerEnabled=false,timerInterval=null,timerSeconds=0;
const SECS_PER_Q=95;let totalTimerSecs=PST.length*SECS_PER_Q;

function toggleTimer(){
  timerEnabled=!timerEnabled;const btn=document.getElementById('timerToggle');
  btn.textContent=timerEnabled?'‚è± Timer ON':'‚è± Timer OFF';btn.classList.toggle('active',timerEnabled);
  if(!timerEnabled&&timerInterval){clearInterval(timerInterval);timerInterval=null;document.getElementById('timerDisplay').textContent='--:--';document.getElementById('timerFill').style.width='100%';}
  else if(timerEnabled&&currentScreen===3){startTimer();}
}
function startTimer(){
  if(timerInterval)clearInterval(timerInterval);timerSeconds=totalTimerSecs;updateTimerDisplay();
  timerInterval=setInterval(()=>{timerSeconds--;updateTimerDisplay();if(timerSeconds<=0){clearInterval(timerInterval);timerInterval=null;}},1000);pstStartTime=Date.now();
}
function updateTimerDisplay(){
  const disp=document.getElementById('timerDisplay'),fill=document.getElementById('timerFill');
  const mins=Math.floor(timerSeconds/60),secs=timerSeconds%60;
  disp.textContent=`${mins}:${secs.toString().padStart(2,'0')}`;
  const pct=(timerSeconds/totalTimerSecs)*100;fill.style.width=pct+'%';
  disp.className='timer-display';fill.className='timer-fill';
  if(pct<15){disp.classList.add('danger');fill.classList.add('danger');}
  else if(pct<35){disp.classList.add('warning');fill.classList.add('warning');}
}

function renderPST(){
  const answered=Object.keys(pstA).length;
  document.getElementById('qDots').innerHTML=PST.map((_,i)=>{let cls='q-dot';if(pstA[i]!==undefined)cls+=pstA[i]===PST[i].c?' correct':' wrong';return `<div class="${cls}"></div>`;}).join('');
  document.getElementById('psatPractice').innerHTML=PST.map((q,i)=>{
    const a=pstA[i],h=a!==undefined;const conf=pstConf[i];
    const tierLabel=q.t===1?'Easy':q.t===2?'Medium':'Hard';
    const trapName=q.trap?TRAP_NAMES[q.trap]||'':'';
    return `<div class="ex-item" style="border-color:${q.t===1?'var(--algebra)':q.t===2?'var(--math)':'var(--advanced)'}">
      <div style="margin-bottom:6px;display:flex;align-items:center;gap:8px;flex-wrap:wrap">
        <span class="tier tier-${q.t}">${tierLabel}</span><span style="font-size:.75rem;color:var(--muted)">Topic ${q.tp}</span>
        ${trapName&&h?`<span style="font-size:.72rem;color:var(--accent)">Trap: ${trapName}</span>`:''}
      </div>
      <div class="ex-prompt">${q.q}</div>
      ${!h?`<div class="confidence-row">
        <div class="conf-tag ${conf==='guessing'?'selected':''}" data-conf="guessing" onclick="setConf(${i},'guessing')">Guessing</div>
        <div class="conf-tag ${conf==='unsure'?'selected':''}" data-conf="unsure" onclick="setConf(${i},'unsure')">Unsure</div>
        <div class="conf-tag ${conf==='confident'?'selected':''}" data-conf="confident" onclick="setConf(${i},'confident')">Confident</div>
      </div>`:`<div style="font-size:.72rem;color:var(--muted);margin-bottom:6px">Confidence: ${conf||'not tagged'}</div>`}
      <div class="mc-choices">${q.ch.map((ch,ci)=>{let c='mc-choice';if(h){c+=' mc-dis';if(ci===q.c)c+=' mc-correct';else if(ci===a)c+=' mc-wrong';}return `<div class="${c}" onclick="aPST(${i},${ci})"><div class="mc-letter">${'ABCD'[ci]}</div><div>${ch}</div></div>`;}).join('')}</div>
      <div class="mc-fb${h?' show':''}">${h?(a===q.c?'‚úì Correct! ':'‚úó Incorrect. ')+q.fb+(a!==q.c&&q.trapAnswer===a?'<br><span style="color:var(--psda)">‚ö†Ô∏è '+q.trapDesc+'</span>':''):''}</div>
    </div>`;
  }).join('');
  if(answered===PST.length){if(timerInterval){clearInterval(timerInterval);timerInterval=null;}document.getElementById('practiceNav').style.display='block';showPracticeResults();}
}
function setConf(i,level){if(pstA[i]!==undefined)return;pstConf[i]=level;renderPST();}
function aPST(i,v){if(pstA[i]!==undefined)return;pstA[i]=v;if(pstStartTime){pstTime[i]=Date.now()-pstStartTime;pstStartTime=Date.now();}renderPST();}

function showPracticeResults(){
  const total=PST.length,correct=Object.entries(pstA).filter(([i,v])=>v===PST[i].c).length;
  const byDiff={1:{cor:0,tot:0},2:{cor:0,tot:0},3:{cor:0,tot:0}};
  PST.forEach((q,i)=>{byDiff[q.t].tot++;if(pstA[i]===q.c)byDiff[q.t].cor++;});
  const matrix={};['guessing','unsure','confident'].forEach(c=>{matrix[c]={correct:[],wrong:[]};});
  PST.forEach((q,i)=>{const conf=pstConf[i]||'unsure';matrix[conf][pstA[i]===q.c?'correct':'wrong'].push(i);});
  const errors={content_gap:[],trap_answer:[],careless:[],calibration:[]};
  PST.forEach((q,i)=>{if(pstA[i]===q.c)return;const conf=pstConf[i]||'unsure';if(pstA[i]===q.trapAnswer)errors.trap_answer.push({i,desc:q.trapDesc,topic:q.tp});else errors.content_gap.push({i,topic:q.tp});if(conf==='confident'){if(q.t===1)errors.careless.push({i,topic:q.tp});errors.calibration.push({i,topic:q.tp});}});

  let html=`<div class="results-section"><h3>üìä Practice Results: ${correct}/${total}</h3>
    <div style="margin-bottom:20px"><div style="font-size:.78rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:8px">By Difficulty</div>
    <div class="difficulty-bars">
      <div class="diff-row"><span class="diff-label" style="color:var(--algebra)">Easy</span><div class="diff-track"><div class="diff-fill" style="width:${byDiff[1].tot?byDiff[1].cor/byDiff[1].tot*100:0}%;background:var(--algebra)"></div></div><span class="diff-val" style="color:var(--algebra)">${byDiff[1].cor}/${byDiff[1].tot}</span></div>
      <div class="diff-row"><span class="diff-label" style="color:var(--math)">Medium</span><div class="diff-track"><div class="diff-fill" style="width:${byDiff[2].tot?byDiff[2].cor/byDiff[2].tot*100:0}%;background:var(--math)"></div></div><span class="diff-val" style="color:var(--math)">${byDiff[2].cor}/${byDiff[2].tot}</span></div>
      <div class="diff-row"><span class="diff-label" style="color:var(--advanced)">Hard</span><div class="diff-track"><div class="diff-fill" style="width:${byDiff[3].tot?byDiff[3].cor/byDiff[3].tot*100:0}%;background:var(--advanced)"></div></div><span class="diff-val" style="color:var(--advanced)">${byDiff[3].cor}/${byDiff[3].tot}</span></div>
    </div></div>`;
  html+=`<div style="margin-bottom:20px"><div style="font-size:.78rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:8px">Confidence √ó Accuracy Matrix</div>
    <div class="results-grid">
      <div class="results-grid-header"></div><div class="results-grid-header">Guessing</div><div class="results-grid-header">Unsure</div><div class="results-grid-header">Confident</div>
      <div class="results-grid-header">‚úì Correct</div>
      <div class="results-grid-cell"><div class="cell-label">Lucky</div><div class="cell-dots">${matrix.guessing.correct.map(()=>'<div class="cell-dot" style="background:var(--psda)"></div>').join('')}</div><div style="font-size:.7rem;color:var(--muted)">${matrix.guessing.correct.length}</div></div>
      <div class="results-grid-cell"><div class="cell-label">Developing</div><div class="cell-dots">${matrix.unsure.correct.map(()=>'<div class="cell-dot" style="background:var(--math)"></div>').join('')}</div><div style="font-size:.7rem;color:var(--muted)">${matrix.unsure.correct.length}</div></div>
      <div class="results-grid-cell"><div class="cell-label">Solid</div><div class="cell-dots">${matrix.confident.correct.map(()=>'<div class="cell-dot" style="background:var(--correct)"></div>').join('')}</div><div style="font-size:.7rem;color:var(--muted)">${matrix.confident.correct.length}</div></div>
      <div class="results-grid-header">‚úó Wrong</div>
      <div class="results-grid-cell"><div class="cell-label">Expected</div><div class="cell-dots">${matrix.guessing.wrong.map(()=>'<div class="cell-dot" style="background:var(--muted)"></div>').join('')}</div><div style="font-size:.7rem;color:var(--muted)">${matrix.guessing.wrong.length}</div></div>
      <div class="results-grid-cell"><div class="cell-label">Needs work</div><div class="cell-dots">${matrix.unsure.wrong.map(()=>'<div class="cell-dot" style="background:var(--psda)"></div>').join('')}</div><div style="font-size:.7rem;color:var(--muted)">${matrix.unsure.wrong.length}</div></div>
      <div class="results-grid-cell danger-cell"><div class="cell-label" style="color:var(--wrong);font-weight:700">‚ö†Ô∏è DANGER</div><div class="cell-dots">${matrix.confident.wrong.map(()=>'<div class="cell-dot" style="background:var(--wrong)"></div>').join('')}</div><div style="font-size:.7rem;color:var(--wrong)">${matrix.confident.wrong.length}</div></div>
    </div>
    ${matrix.confident.wrong.length>0?'<div class="callout" style="border-color:var(--wrong);background:var(--wrong-bg)"><strong style="color:var(--wrong)">Confident + Wrong</strong> is the most dangerous category. These errors persist because you won\'t self-correct what you think you already know.</div>':''}
  </div>`;
  const hasErrors=errors.trap_answer.length+errors.content_gap.length>0;
  if(hasErrors){
    html+=`<div style="margin-bottom:16px"><div style="font-size:.78rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:8px">Error Pattern Analysis</div>`;
    if(errors.trap_answer.length>0)html+=`<div class="error-category" style="background:rgba(251,191,36,.08);border:1px solid rgba(251,191,36,.3)"><div class="error-label" style="color:var(--psda)">üü° Trap Answers (${errors.trap_answer.length})</div><div class="error-items">${errors.trap_answer.map(e=>e.desc).join(' ¬∑ ')}</div></div>`;
    if(errors.content_gap.length>0)html+=`<div class="error-category" style="background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.3)"><div class="error-label" style="color:var(--wrong)">üî¥ Content Gaps (${errors.content_gap.length})</div><div class="error-items">Topics: ${[...new Set(errors.content_gap.map(e=>e.topic))].join(', ')}</div></div>`;
    if(errors.careless.length>0)html+=`<div class="error-category" style="background:rgba(96,165,250,.08);border:1px solid rgba(96,165,250,.3)"><div class="error-label" style="color:var(--math)">üîµ Possible Careless Errors (${errors.careless.length})</div><div class="error-items">Confident + wrong on easy questions ‚Äî likely arithmetic mistakes</div></div>`;
    if(errors.calibration.length>0)html+=`<div class="error-category" style="background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.3)"><div class="error-label" style="color:var(--wrong)">‚ö†Ô∏è Calibration Issues (${errors.calibration.length})</div><div class="error-items">You were confident but wrong ‚Äî review these topics carefully</div></div>`;
    html+=`</div>`;
  }
  html+=`</div>`;
  document.getElementById('practiceResults').style.display='block';
  document.getElementById('practiceResults').innerHTML=html;
  document.getElementById('completePracticeStats').innerHTML=`
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 20px;margin-bottom:24px;max-width:500px;width:100%;text-align:left">
      <div style="font-size:.78rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:8px">Practice Results</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:1.4rem;font-weight:700;color:var(--correct);margin-bottom:8px">${correct}/${total} correct</div>
      <div style="font-size:.82rem;color:var(--muted)">Easy: ${byDiff[1].cor}/${byDiff[1].tot} ¬∑ Medium: ${byDiff[2].cor}/${byDiff[2].tot} ¬∑ Hard: ${byDiff[3].cor}/${byDiff[3].tot}</div>
    </div>`;
}
renderPST();
</script>
<script src="/translate.js"></script>
</body>
</html>
