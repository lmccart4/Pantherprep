<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAT Math Diagnostic ‚Äî PantherPrep</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=IBM+Plex+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<style>
:root {
  --ink: #f0f0f0;
  --paper: #121212;
  --accent: #C8102E;
  --accent-light: rgba(200,16,46,.15);
  --correct: #22c55e;
  --correct-bg: rgba(34,197,94,.12);
  --wrong: #ef4444;
  --wrong-bg: rgba(239,68,68,.12);
  --spr: #f59e0b;
  --spr-bg: rgba(245,158,11,.12);
  --border: #2a2a2a;
  --muted: #999;
  --surface: #1a1a1a;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'IBM Plex Sans',sans-serif; background:var(--paper); color:var(--ink); line-height:1.6; }
.container { max-width:820px; margin:0 auto; padding:20px; }
.top-stripe{height:4px;background:linear-gradient(90deg,#C8102E 0%,#C8102E 50%,#fff 50%,#fff 100%);position:fixed;top:0;left:0;right:0;z-index:100}
.back-to-app{display:inline-flex;align-items:center;gap:8px;color:var(--muted);font-size:.9rem;padding:8px 0;cursor:pointer;text-decoration:none;margin-bottom:12px;margin-top:8px}
.back-to-app:hover{color:var(--accent)}

/* LANDING */
.landing { text-align:center; padding:60px 20px; }
.landing-badge { display:inline-block; background:var(--accent); color:#fff; font-size:11px; font-weight:700; letter-spacing:2px; text-transform:uppercase; padding:6px 16px; border-radius:20px; margin-bottom:20px; }
.landing h1 { font-family:'DM Serif Display',serif; font-size:clamp(2rem,5vw,3.2rem); margin-bottom:8px; }
.landing .subtitle { color:var(--muted); font-size:1.05rem; margin-bottom:36px; }
.spec-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:16px; max-width:600px; margin:0 auto 36px; text-align:left; }
.spec-card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:16px; }
.spec-card .label { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:var(--muted); margin-bottom:4px; }
.spec-card .value { font-size:1.15rem; font-weight:600; }
.domain-bar { display:flex; gap:2px; border-radius:8px; overflow:hidden; height:10px; max-width:600px; margin:0 auto 12px; }
.domain-bar div:nth-child(1) { flex:35; background:#2563eb; }
.domain-bar div:nth-child(2) { flex:35; background:#7c3aed; }
.domain-bar div:nth-child(3) { flex:15; background:#059669; }
.domain-bar div:nth-child(4) { flex:15; background:#ea580c; }
.domain-legend { display:flex; flex-wrap:wrap; justify-content:center; gap:16px; margin-bottom:36px; font-size:0.85rem; }
.domain-legend span::before { content:''; display:inline-block; width:10px; height:10px; border-radius:3px; margin-right:6px; vertical-align:middle; }
.domain-legend .alg::before { background:#60a5fa; }
.domain-legend .adv::before { background:#a78bfa; }
.domain-legend .psd::before { background:#34d399; }
.domain-legend .geo::before { background:#fb923c; }
.btn { display:inline-block; background:var(--accent); color:#fff; font-family:inherit; font-size:1rem; font-weight:600; padding:14px 40px; border:none; border-radius:10px; cursor:pointer; transition:all 0.2s; }
.btn:hover { background:#a00d24; transform:translateY(-1px); box-shadow:0 4px 12px rgba(200,16,46,0.3); }
.btn-outline { background:transparent; color:var(--accent); border:2px solid var(--accent); }
.btn-outline:hover { background:var(--accent-light); transform:translateY(-1px); box-shadow:none; }
.btn-sm { padding:10px 24px; font-size:0.9rem; }

/* TEST UI */
.test-header { display:flex; justify-content:space-between; align-items:center; padding:14px 0; border-bottom:2px solid var(--ink); margin-bottom:24px; }
.test-header .module-label { font-weight:700; font-size:0.95rem; }
.test-header .timer { font-family:'JetBrains Mono',monospace; font-size:1.1rem; font-weight:500; }
.timer.warning { color:var(--wrong); animation:pulse 1s infinite; }
@keyframes pulse { 50% { opacity:0.6; } }
.progress-bar { height:4px; background:var(--border); border-radius:2px; margin-bottom:28px; }
.progress-fill { height:100%; background:var(--accent); border-radius:2px; transition:width 0.3s; }
.q-counter { font-size:0.85rem; color:var(--muted); margin-bottom:8px; }
.domain-tag { display:inline-block; font-size:11px; font-weight:700; letter-spacing:0.5px; text-transform:uppercase; padding:3px 10px; border-radius:12px; margin-bottom:12px; }
.domain-tag.algebra { background:rgba(37,99,235,.15); color:#60a5fa; }
.domain-tag.advanced { background:rgba(124,58,237,.15); color:#a78bfa; }
.domain-tag.psda { background:rgba(5,150,105,.15); color:#34d399; }
.domain-tag.geotrig { background:rgba(234,88,12,.15); color:#fb923c; }
.spr-badge { display:inline-block; background:var(--spr-bg); color:var(--spr); font-size:11px; font-weight:700; padding:3px 10px; border-radius:12px; margin-left:8px; border-left:3px solid var(--spr); }
.passage { background:var(--surface); border-left:3px solid var(--border); padding:14px 18px; margin-bottom:16px; border-radius:0 8px 8px 0; font-size:0.95rem; line-height:1.7; }
.q-text { font-size:1.1rem; font-weight:500; margin-bottom:20px; line-height:1.6; }
.choices { display:flex; flex-direction:column; gap:10px; margin-bottom:24px; }
.choice { display:flex; align-items:flex-start; gap:12px; padding:14px 16px; background:var(--surface); border:2px solid var(--border); border-radius:10px; cursor:pointer; transition:all 0.15s; }
.choice:hover { border-color:var(--accent); background:var(--accent-light); }
.choice.selected { border-color:var(--accent); background:var(--accent-light); }
.choice.correct-choice { border-color:var(--correct); background:var(--correct-bg); }
.choice.wrong-choice { border-color:var(--wrong); background:var(--wrong-bg); }
.choice-letter { flex-shrink:0; width:28px; height:28px; display:flex; align-items:center; justify-content:center; border-radius:50%; background:var(--border); color:var(--ink); font-weight:700; font-size:0.85rem; }
.choice.selected .choice-letter { background:var(--accent); color:#fff; }
.choice.correct-choice .choice-letter { background:var(--correct); color:#fff; }
.choice.wrong-choice .choice-letter { background:var(--wrong); color:#fff; }
.choice-text { padding-top:3px; }
.spr-input { display:flex; align-items:center; gap:12px; margin-bottom:24px; }
.spr-input input { font-family:'JetBrains Mono',monospace; font-size:1.2rem; padding:12px 16px; border:2px solid var(--spr); border-radius:10px; background:var(--spr-bg); width:200px; outline:none; }
.spr-input input:focus { box-shadow:0 0 0 3px rgba(234,88,12,0.2); }
.nav-buttons { display:flex; justify-content:space-between; gap:12px; margin-top:20px; }
.explanation-box { margin-top:16px; padding:18px; border-radius:10px; font-size:0.93rem; line-height:1.65; }
.explanation-box.correct { background:var(--correct-bg); border:1px solid var(--correct); }
.explanation-box.wrong { background:var(--wrong-bg); border:1px solid var(--wrong); }
.explanation-box h4 { margin-bottom:8px; }
.explanation-box .exp-item { margin-bottom:6px; }
.reference-sheet { background:rgba(245,158,11,.08); border:1px solid rgba(245,158,11,.3); border-radius:10px; padding:16px; margin-bottom:20px; font-size:0.88rem; }
.reference-sheet summary { font-weight:700; cursor:pointer; color:#f59e0b; }
.reference-sheet .formulas { margin-top:10px; columns:2; column-gap:20px; }
.reference-sheet .formulas p { margin-bottom:4px; font-family:'JetBrains Mono',monospace; font-size:0.82rem; break-inside:avoid; }

/* RESULTS */
.results { text-align:center; padding:40px 0; }
.results h1 { font-family:'DM Serif Display',serif; font-size:2.2rem; margin-bottom:6px; }
.score-circle { width:160px; height:160px; border-radius:50%; border:6px solid var(--accent); display:flex; flex-direction:column; align-items:center; justify-content:center; margin:24px auto; background:var(--surface); }
.score-circle .score-num { font-family:'DM Serif Display',serif; font-size:2.8rem; line-height:1; }
.score-circle .score-range { font-size:0.8rem; color:var(--muted); }
.stats-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:14px; margin:24px 0; }
.stat-box { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:16px; }
.stat-box .stat-val { font-size:1.5rem; font-weight:700; }
.stat-box .stat-label { font-size:0.8rem; color:var(--muted); text-transform:uppercase; letter-spacing:0.5px; }
.domain-results { text-align:left; margin:30px 0; }
.domain-result-row { display:flex; align-items:center; gap:12px; padding:12px 0; border-bottom:1px solid var(--border); }
.domain-result-row .dr-name { flex:1; font-weight:600; }
.domain-result-row .dr-bar-wrap { flex:2; height:12px; background:var(--border); border-radius:6px; overflow:hidden; }
.domain-result-row .dr-bar { height:100%; border-radius:6px; transition:width 0.8s; }
.domain-result-row .dr-score { width:60px; text-align:right; font-weight:700; font-family:'JetBrains Mono',monospace; }
.review-section { text-align:left; margin:30px 0; }
.review-section h3 { font-family:'DM Serif Display',serif; font-size:1.3rem; margin-bottom:16px; }
.review-q { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:16px; margin-bottom:12px; }
.review-q .rq-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.review-q .rq-status { font-weight:700; font-size:0.85rem; }
.review-q .rq-status.correct { color:var(--correct); }
.review-q .rq-status.wrong { color:var(--wrong); }
.review-q .rq-status.skipped { color:var(--muted); }
.reflection-section { text-align:left; margin:30px 0; background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:24px; }
.reflection-section h3 { font-family:'DM Serif Display',serif; margin-bottom:16px; }
.reflection-q { margin-bottom:16px; }
.reflection-q label { display:block; font-weight:500; margin-bottom:6px; }
.reflection-q textarea { width:100%; padding:10px; border:1px solid var(--border); border-radius:8px; font-family:inherit; font-size:0.9rem; resize:vertical; min-height:60px; background:var(--surface); color:var(--ink); }

/* QUESTION NAVIGATOR */
.q-nav { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:20px; padding:12px; background:var(--surface); border:1px solid var(--border); border-radius:10px; }
.q-nav button { width:32px; height:32px; border:1px solid var(--border); border-radius:6px; background:var(--surface); color:var(--ink); font-size:0.78rem; font-weight:600; cursor:pointer; transition:all 0.15s; font-family:inherit; }
.q-nav button.current { background:var(--accent); color:#fff; border-color:var(--accent); }
.q-nav button.answered { background:var(--accent-light); border-color:var(--accent); color:var(--ink); }
.q-nav button.flagged { border-color:#f59e0b; background:rgba(245,158,11,.12); }
.flag-btn { background:none; border:1px solid var(--border); border-radius:8px; padding:8px 14px; cursor:pointer; font-size:0.85rem; font-family:inherit; display:flex; align-items:center; gap:6px; }
.flag-btn.flagged { border-color:#f59e0b; background:rgba(245,158,11,.12); color:#fbbf24; }

.hidden { display:none; }
@media(max-width:600px) {
  .spec-grid { grid-template-columns:1fr 1fr; }
  .stats-row { grid-template-columns:1fr 1fr; }
  .reference-sheet .formulas { columns:1; }
  .nav-buttons { flex-direction:column; }
}
</style>
</head>
<body>
<div class="top-stripe"></div>
<div class="container" id="app"></div>

<script>
// ============================================================
// SAT MATH DIAGNOSTIC ‚Äî 44 QUESTIONS
// Algebra:14, Advanced Math:14, PS&DA:7, Geometry&Trig:9
// ~11 SPR questions, ~30% word problems
// Module 1: Q1-22 (mixed difficulty)
// Module 2: Q23-44 (harder, simulating upper adaptive path)
// ============================================================

const ALL_QUESTIONS = [
// =================== MODULE 1 (Q1-22) ===================

// --- ALGEBRA (Q1-7) ---
{num:1,module:1,type:"MC",passage:"",
question:"If 3(2x ‚àí 4) = 18, what is the value of x?",
A:"3",B:"5",C:"7",D:"11",
correct:"B",domain:"Algebra",skill:"Linear equations in 1 variable",
explanations:{
A:"If x=3: 3(6‚àí4)=6, not 18.",
B:"Distribute: 6x‚àí12=18. Add 12: 6x=30. Divide: x=5. Check: 3(10‚àí4)=3(6)=18. ‚úì",
C:"Likely from dividing 18 by 3 and adding 4 without accounting for the coefficient of x.",
D:"Comes from adding 18+4=22, then ignoring the factor of 6."}},

{num:2,module:1,type:"MC",
passage:"A landscaping company charges $75 for a consultation plus $40 per hour of labor. A client has a budget of $355 for a project.",
question:"Which inequality represents the number of hours h of labor the client can afford?",
A:"75h + 40 ‚â§ 355",B:"40h + 75 ‚â§ 355",C:"40h + 75 ‚â• 355",D:"75 + 40h > 355",
correct:"B",domain:"Algebra",skill:"Linear inequalities",
explanations:{
A:"This reverses the roles of 75 and 40. The $75 is a flat fee, not a per-hour rate.",
B:"Total cost = 75 + 40h. To stay within budget: 40h + 75 ‚â§ 355. Solving: 40h ‚â§ 280, h ‚â§ 7 hours. ‚úì",
C:"This says the cost must be at least $355 ‚Äî the opposite of a budget constraint.",
D:"This says the cost must exceed the budget, which is the wrong direction."}},

{num:3,module:1,type:"MC",passage:"",
question:"Line ‚Ñì passes through the points (‚àí2, 5) and (4, ‚àí1). What is the slope of line ‚Ñì?",
A:"‚àí1",B:"‚àí2/3",C:"2/3",D:"1",
correct:"A",domain:"Algebra",skill:"Linear functions",
explanations:{
A:"Slope = (y‚ÇÇ‚àíy‚ÇÅ)/(x‚ÇÇ‚àíx‚ÇÅ) = (‚àí1‚àí5)/(4‚àí(‚àí2)) = ‚àí6/6 = ‚àí1. ‚úì",
B:"This results from a sign error in the denominator: using 4‚àí2=2 instead of 4‚àí(‚àí2)=6.",
C:"This flips the sign; the line clearly goes down from left to right.",
D:"Correct magnitude but wrong sign. The line decreases, so slope is negative."}},

{num:4,module:1,type:"SPR",passage:"The system of equations below has a solution (x, y).\n\n2x + 3y = 19\n4x ‚àí y = 3",
question:"What is the value of y?",
correct:"5",domain:"Algebra",skill:"Systems of linear equations",
explanations:{
correct:"From the second equation: y = 4x ‚àí 3. Substitute into the first: 2x + 3(4x ‚àí 3) = 19 ‚Üí 2x + 12x ‚àí 9 = 19 ‚Üí 14x = 28 ‚Üí x = 2. Then y = 4(2) ‚àí 3 = 5."}},

{num:5,module:1,type:"MC",passage:"",
question:"Which of the following is equivalent to 2(3x ‚àí 1) ‚àí (x + 5)?",
A:"5x ‚àí 7",B:"5x + 3",C:"5x ‚àí 3",D:"7x ‚àí 7",
correct:"A",domain:"Algebra",skill:"Equivalent expressions",
explanations:{
A:"Distribute: 6x ‚àí 2 ‚àí x ‚àí 5 = 5x ‚àí 7. ‚úì",
B:"Sign error: forgot to distribute the negative to the +5, getting ‚àí2+5=3.",
C:"Only partially distributed the negative: got ‚àí2‚àí(‚àí5) instead of ‚àí2‚àí5.",
D:"Added the x-coefficients as 6+1=7 instead of 6‚àí1=5."}},

{num:6,module:1,type:"MC",
passage:"The table shows the cost C (in dollars) of renting a kayak for h hours at two rental shops.\n\nShop A: C = 15h + 20\nShop B: C = 12h + 35",
question:"For how many hours of rental will both shops charge the same amount?",
A:"3",B:"5",C:"7",D:"15",
correct:"B",domain:"Algebra",skill:"Systems of equations (word problems)",
explanations:{
A:"At h=3: Shop A = 65, Shop B = 71. Not equal.",
B:"Set equal: 15h + 20 = 12h + 35 ‚Üí 3h = 15 ‚Üí h = 5. Check: A = 95, B = 95. ‚úì",
C:"At h=7: Shop A = 125, Shop B = 119. Not equal.",
D:"15 is the value of 3h, not h."}},

{num:7,module:1,type:"MC",passage:"",
question:"If f(x) = 4x ‚àí 7, what is the value of f(‚àí3)?",
A:"‚àí19",B:"‚àí5",C:"5",D:"19",
correct:"A",domain:"Algebra",skill:"Function notation",
explanations:{
A:"f(‚àí3) = 4(‚àí3) ‚àí 7 = ‚àí12 ‚àí 7 = ‚àí19. ‚úì",
B:"This comes from computing 4(‚àí3) + 7 = ‚àí5 (wrong sign on 7).",
C:"Absolute value error: |‚àí12‚àí7| would be 19, not 5. This is 4(3)‚àí7.",
D:"Used |4(‚àí3)‚àí7| = |‚àí19| = 19, dropping the negative."}},

// --- ADVANCED MATH (Q8-14) ---
{num:8,module:1,type:"MC",passage:"",
question:"Which of the following is equivalent to x¬≤ ‚àí 9?",
A:"(x ‚àí 3)¬≤",B:"(x + 3)(x ‚àí 3)",C:"(x ‚àí 9)(x + 1)",D:"(x + 9)(x ‚àí 1)",
correct:"B",domain:"Advanced Math",skill:"Equivalent expressions (factoring)",
explanations:{
A:"(x‚àí3)¬≤ = x¬≤‚àí6x+9, not x¬≤‚àí9. Missing the cross term.",
B:"Difference of squares: a¬≤‚àíb¬≤ = (a+b)(a‚àíb). Here a=x, b=3. x¬≤‚àí9 = (x+3)(x‚àí3). ‚úì",
C:"(x‚àí9)(x+1) = x¬≤‚àí8x‚àí9. Incorrect factoring.",
D:"(x+9)(x‚àí1) = x¬≤+8x‚àí9. Also incorrect."}},

{num:9,module:1,type:"MC",passage:"",
question:"What are the solutions of x¬≤ ‚àí 5x ‚àí 6 = 0?",
A:"x = ‚àí1 and x = 6",B:"x = 1 and x = ‚àí6",C:"x = ‚àí2 and x = 3",D:"x = 2 and x = ‚àí3",
correct:"A",domain:"Advanced Math",skill:"Quadratic equations",
explanations:{
A:"Factor: (x‚àí6)(x+1) = 0. Two numbers that multiply to ‚àí6 and add to ‚àí5 are ‚àí6 and +1. So x=6 or x=‚àí1. ‚úì",
B:"Sign error in factoring. (x‚àí1)(x+6) gives x¬≤+5x‚àí6, not x¬≤‚àí5x‚àí6.",
C:"(x+2)(x‚àí3) = x¬≤‚àíx‚àí6. The middle term is wrong.",
D:"(x‚àí2)(x+3) = x¬≤+x‚àí6. Also doesn't match."}},

{num:10,module:1,type:"SPR",passage:"",
question:"If (x + 3)¬≤ = 49, what is the positive value of x?",
correct:"4",domain:"Advanced Math",skill:"Radical/rational equations",
explanations:{
correct:"Take square root: x + 3 = ¬±7. So x = 4 or x = ‚àí10. The positive value is 4."}},

{num:11,module:1,type:"MC",passage:"",
question:"The function g is defined by g(x) = 2x¬≤ ‚àí 8x + 6. What is the minimum value of g(x)?",
A:"‚àí2",B:"‚àí1",C:"0",D:"2",
correct:"A",domain:"Advanced Math",skill:"Quadratic functions (vertex)",
explanations:{
A:"Complete the square: g(x) = 2(x¬≤‚àí4x) + 6 = 2(x¬≤‚àí4x+4‚àí4) + 6 = 2(x‚àí2)¬≤ ‚àí 8 + 6 = 2(x‚àí2)¬≤ ‚àí 2. Minimum value is ‚àí2 when x=2. ‚úì",
B:"Arithmetic error in completing the square.",
C:"This is g(1) = 2‚àí8+6 = 0, but not the minimum.",
D:"This is g(0) = 6, also not the minimum."}},

{num:12,module:1,type:"MC",passage:"A population of bacteria doubles every 3 hours. At time t = 0, there are 500 bacteria.",
question:"Which function models the population P after t hours?",
A:"P(t) = 500(2)^(t/3)",B:"P(t) = 500(2)^(3t)",C:"P(t) = 500(3)^(t/2)",D:"P(t) = 500 + 2t/3",
correct:"A",domain:"Advanced Math",skill:"Exponential functions",
explanations:{
A:"Doubling every 3 hours means the growth factor is 2 per 3-hour period. In t hours there are t/3 periods, so P(t) = 500¬∑2^(t/3). ‚úì",
B:"This doubles every 1/3 hour (20 min), far too fast.",
C:"Uses base 3 and period 2 ‚Äî swapped values.",
D:"Linear model, not exponential. Bacteria don't grow at a constant rate."}},

{num:13,module:1,type:"MC",passage:"",
question:"If p(x) = x¬≥ + 2x¬≤ ‚àí 5x ‚àí 6, which of the following is a factor of p(x)?",
A:"(x ‚àí 1)",B:"(x + 1)",C:"(x ‚àí 3)",D:"(x + 3)",
correct:"D",domain:"Advanced Math",skill:"Polynomial functions",
explanations:{
A:"p(1) = 1+2‚àí5‚àí6 = ‚àí8 ‚â† 0.",
B:"p(‚àí1) = ‚àí1+2+5‚àí6 = 0. Wait ‚Äî this is also a factor! But let's check D.",
C:"p(3) = 27+18‚àí15‚àí6 = 24 ‚â† 0.",
D:"p(‚àí3) = ‚àí27+18+15‚àí6 = 0. So (x+3) is a factor. ‚úì (Note: (x+1) is also a factor; the polynomial factors as (x+1)(x‚àí2)(x+3).)"}},

{num:14,module:1,type:"SPR",passage:"",
question:'If (2x + 5)(x ‚àí 3) = 2x¬≤ + bx ‚àí 15, what is the value of b?',
correct:"-1",domain:"Advanced Math",skill:"Equivalent expressions",
explanations:{
correct:"Expand: (2x+5)(x‚àí3) = 2x¬≤‚àí6x+5x‚àí15 = 2x¬≤‚àíx‚àí15. So b = ‚àí1."}},

// --- PROBLEM-SOLVING & DATA ANALYSIS (Q15-18) ---
{num:15,module:1,type:"MC",
passage:"A store marks up the wholesale price of a jacket by 60%, then offers a 25% discount on the marked-up price. The wholesale price is $80.",
question:"What is the final sale price of the jacket?",
A:"$92.00",B:"$96.00",C:"$100.80",D:"$108.00",
correct:"B",domain:"Problem-Solving & Data Analysis",skill:"Percentages",
explanations:{
A:"This comes from a 15% markup (60‚àí25=35% error). Sequential percentages don't subtract.",
B:"Markup: 80 √ó 1.60 = $128. Discount: 128 √ó 0.75 = $96. ‚úì",
C:"Computed 60% of 80 = 48, then subtracted 25% of 48 = 12, getting 80+48‚àí12 = 116. Incorrect method.",
D:"Only applied the 60% markup on the original $80 minus 25% of $80: 128‚àí20 = 108. Discount should apply to marked-up price."}},

{num:16,module:1,type:"MC",
passage:"A survey of 200 students found that 120 play a sport, 90 are in a club, and 40 do both.",
question:"What fraction of students who play a sport are also in a club?",
A:"1/5",B:"1/3",C:"2/9",D:"4/9",
correct:"B",domain:"Problem-Solving & Data Analysis",skill:"Two-way tables / conditional probability",
explanations:{
A:"40/200 = 1/5 is the fraction of ALL students who do both, not the conditional.",
B:"Of the 120 who play a sport, 40 are also in a club. 40/120 = 1/3. ‚úì",
C:"40/180 ‚Äî incorrect denominator.",
D:"40/90 ‚Äî this is the fraction of club members who also play a sport, which is the wrong condition."}},

{num:17,module:1,type:"SPR",
passage:"A recipe calls for flour and sugar in a ratio of 5 : 2. If 3.5 cups of flour are used, how many cups of sugar are needed?",
question:"How many cups of sugar are needed?",
correct:"1.4",domain:"Problem-Solving & Data Analysis",skill:"Ratios and proportions",
explanations:{
correct:"flour/sugar = 5/2, so 3.5/sugar = 5/2. Cross multiply: 5 √ó sugar = 7 ‚Üí sugar = 7/5 = 1.4 cups."}},

{num:18,module:1,type:"MC",
passage:"A researcher collected data on study hours and test scores for 15 students and found a linear regression model with r¬≤ = 0.81.",
question:"Which of the following is the best interpretation of r¬≤ = 0.81?",
A:"81% of students scored above average on the test.",
B:"For every additional hour of study, the test score increases by 81%.",
C:"Approximately 81% of the variation in test scores is explained by the number of study hours.",
D:"The correlation between study hours and test scores is 0.81.",
correct:"C",domain:"Problem-Solving & Data Analysis",skill:"Scatterplots and regression",
explanations:{
A:"r¬≤ doesn't describe what percentage of students achieved a certain score.",
B:"r¬≤ isn't a rate of change ‚Äî that's the slope of the regression line.",
C:"r¬≤ is the coefficient of determination: the proportion of variation in the dependent variable explained by the independent variable. ‚úì",
D:"The correlation r = ‚àö0.81 = 0.9, not 0.81. r¬≤ and r are different values."}},

// --- GEOMETRY & TRIGONOMETRY (Q19-22) ---
{num:19,module:1,type:"MC",passage:"",
question:"A circle has the equation (x ‚àí 3)¬≤ + (y + 2)¬≤ = 25. What is the radius of the circle?",
A:"3",B:"5",C:"12.5",D:"25",
correct:"B",domain:"Geometry & Trigonometry",skill:"Circle equations",
explanations:{
A:"3 is the x-coordinate of the center, not the radius.",
B:"The standard form is (x‚àíh)¬≤+(y‚àík)¬≤=r¬≤. Here r¬≤=25, so r=5. ‚úì",
C:"25/2 = 12.5 ‚Äî no reason to divide by 2.",
D:"25 is r¬≤, not r. Must take the square root."}},

{num:20,module:1,type:"SPR",passage:"",
question:"A right triangle has legs of length 9 and 12. What is the length of the hypotenuse?",
correct:"15",domain:"Geometry & Trigonometry",skill:"Right triangles / Pythagorean theorem",
explanations:{
correct:"By the Pythagorean theorem: c¬≤ = 9¬≤ + 12¬≤ = 81 + 144 = 225. So c = 15. (This is a 3-4-5 triple scaled by 3.)"}},

{num:21,module:1,type:"MC",
passage:"In right triangle ABC, angle C = 90¬∞, AC = 5, and BC = 12.",
question:"What is sin(A)?",
A:"5/13",B:"12/13",C:"5/12",D:"12/5",
correct:"B",domain:"Geometry & Trigonometry",skill:"Trigonometric ratios",
explanations:{
A:"This is cos(A). sin(A) = opposite/hypotenuse, and the side opposite A is BC.",
B:"First find AB (hypotenuse): ‚àö(25+144) = ‚àö169 = 13. sin(A) = opposite/hypotenuse = BC/AB = 12/13. ‚úì",
C:"This is tan(A) with sides reversed: 5/12 = adjacent/opposite.",
D:"This is tan(A) = opposite/adjacent = 12/5."}},

{num:22,module:1,type:"MC",
passage:"A cylinder has a radius of 4 cm and a height of 10 cm.",
question:"What is the volume of the cylinder, in cubic centimeters?",
A:"40œÄ",B:"80œÄ",C:"160œÄ",D:"640œÄ",
correct:"C",domain:"Geometry & Trigonometry",skill:"Volume",
explanations:{
A:"40œÄ = œÄ(4)(10), using V = œÄrh instead of œÄr¬≤h.",
B:"80œÄ = œÄ(4)¬≤(10)/2 ‚Äî no reason to halve the volume.",
C:"V = œÄr¬≤h = œÄ(16)(10) = 160œÄ. ‚úì",
D:"640œÄ = œÄ(4)¬≥(10) ‚Äî used r¬≥ instead of r¬≤."}},

// =================== MODULE 2 (Q23-44) ‚Äî HARDER ===================

// --- ALGEBRA (Q23-29) ---
{num:23,module:2,type:"MC",passage:"",
question:"The equation (3/4)x ‚àí (2/3) = (5/6)x + 1 has what solution for x?",
A:"‚àí20",B:"‚àí10",C:"10",D:"20",
correct:"A",domain:"Algebra",skill:"Linear equations with fractions",
explanations:{
A:"Multiply everything by 12: 9x ‚àí 8 = 10x + 12. Subtract 9x: ‚àí8 = x + 12. Subtract 12: x = ‚àí20. ‚úì",
B:"Sign error or arithmetic mistake in clearing fractions.",
C:"Forgot to multiply the constant terms by 12.",
D:"Positive version ‚Äî dropped a negative sign."}},

{num:24,module:2,type:"MC",passage:"",
question:"For what value of a does the equation a(x + 2) = 3x + 6 have infinitely many solutions?",
A:"1",B:"2",C:"3",D:"6",
correct:"C",domain:"Algebra",skill:"Special solutions (identity equations)",
explanations:{
A:"1(x+2)=x+2, but 3x+6 ‚â† x+2 for all x.",
B:"2(x+2)=2x+4, but 3x+6 ‚â† 2x+4 for all x.",
C:"3(x+2)=3x+6, which equals the right side for ALL x. Infinitely many solutions. ‚úì",
D:"6(x+2)=6x+12, not equal to 3x+6 for all x."}},

{num:25,module:2,type:"SPR",
passage:"A phone plan costs $35 per month plus $0.05 per text message. Another plan costs $20 per month plus $0.15 per text message.",
question:"How many text messages per month make the two plans cost the same?",
correct:"150",domain:"Algebra",skill:"Systems of equations (word problems)",
explanations:{
correct:"Set equal: 35 + 0.05t = 20 + 0.15t ‚Üí 15 = 0.10t ‚Üí t = 150 messages."}},

{num:26,module:2,type:"MC",passage:"",
question:"If |2x ‚àí 7| = 11, what is the sum of all possible values of x?",
A:"3",B:"7",C:"9",D:"11",
correct:"B",domain:"Algebra",skill:"Absolute value equations",
explanations:{
A:"One solution is x = ‚àí2 and the other is x = 9. Their sum is 7, not 3.",
B:"Case 1: 2x‚àí7 = 11 ‚Üí x = 9. Case 2: 2x‚àí7 = ‚àí11 ‚Üí x = ‚àí2. Sum: 9 + (‚àí2) = 7. ‚úì",
C:"9 is just one of the two solutions.",
D:"11 is the value on the right side of the equation, not a sum of solutions."}},

{num:27,module:2,type:"MC",passage:"",
question:"Line m is perpendicular to the line y = (2/5)x + 3. What is the slope of line m?",
A:"‚àí5/2",B:"‚àí2/5",C:"2/5",D:"5/2",
correct:"A",domain:"Algebra",skill:"Perpendicular lines",
explanations:{
A:"Perpendicular slopes are negative reciprocals. The negative reciprocal of 2/5 is ‚àí5/2. ‚úì",
B:"This is just the negative, not the reciprocal.",
C:"Same slope means parallel, not perpendicular.",
D:"Reciprocal but not negated."}},

{num:28,module:2,type:"MC",
passage:"A chemist mixes a 20% acid solution with a 50% acid solution to create 30 liters of a 32% acid solution.",
question:"How many liters of the 20% solution are used?",
A:"12",B:"15",C:"18",D:"24",
correct:"C",domain:"Algebra",skill:"Mixture problems",
explanations:{
A:"If 12 L of 20%: 12(0.20)+18(0.50) = 2.4+9.0 = 11.4 ‚Üí 38%, too high.",
B:"If 15 L of each: 15(0.20)+15(0.50) = 3+7.5 = 10.5 ‚Üí 35%, too high.",
C:"Let x = liters of 20%. Then 30‚àíx = liters of 50%. 0.20x + 0.50(30‚àíx) = 0.32(30). 0.20x + 15 ‚àí 0.50x = 9.6. ‚àí0.30x = ‚àí5.4. x = 18. ‚úì",
D:"If 24 L of 20%: 24(0.20)+6(0.50) = 4.8+3.0 = 7.8 ‚Üí 26%, too low."}},

{num:29,module:2,type:"SPR",passage:"",
question:"If 3x ‚àí 2y = 12 and x + 2y = 8, what is the value of 2x + y?",
correct:"11.5",domain:"Algebra",skill:"Systems of equations",
explanations:{
correct:"Add the equations: (3x‚àí2y)+(x+2y) = 12+8 ‚Üí 4x = 20 ‚Üí x = 5. Substitute into x+2y=8: 5+2y=8 ‚Üí 2y=3 ‚Üí y=1.5. Therefore 2x+y = 2(5)+1.5 = 11.5."}},

// --- ADVANCED MATH (Q30-36) ---
{num:30,module:2,type:"MC",passage:"",
question:"Which expression is equivalent to (x¬≤ ‚àí 4x + 4) / (x¬≤ ‚àí 4)?",
A:"(x ‚àí 2)/(x + 2)",B:"(x + 2)/(x ‚àí 2)",C:"1",D:"(x ‚àí 4)/(x ‚àí 4)",
correct:"A",domain:"Advanced Math",skill:"Rational expressions",
explanations:{
A:"Numerator: x¬≤‚àí4x+4 = (x‚àí2)¬≤. Denominator: x¬≤‚àí4 = (x‚àí2)(x+2). Cancel one (x‚àí2): (x‚àí2)/(x+2). ‚úì",
B:"This inverts the result. The (x‚àí2) remains in the numerator.",
C:"The numerator and denominator are not equal expressions.",
D:"Neither the numerator nor denominator factors to (x‚àí4)."}},

{num:31,module:2,type:"MC",passage:"",
question:"The function h(x) = ‚àí2(x ‚àí 3)¬≤ + 8 has a maximum value. What is the x-coordinate of the vertex?",
A:"‚àí3",B:"2",C:"3",D:"8",
correct:"C",domain:"Advanced Math",skill:"Vertex form of quadratics",
explanations:{
A:"The vertex form is a(x‚àíh)¬≤+k, so h=3, not ‚àí3. Don't negate the value inside.",
B:"No basis for this value.",
C:"In h(x) = ‚àí2(x‚àí3)¬≤+8, the vertex is at (3, 8). The x-coordinate is 3. ‚úì",
D:"8 is the y-coordinate (maximum value), not the x-coordinate."}},

{num:32,module:2,type:"SPR",passage:"",
question:"If f(x) = x¬≤ + 3x and g(x) = 2x ‚àí 1, what is f(g(2))?",
A:"",correct:"18",domain:"Advanced Math",skill:"Composition of functions",
explanations:{
correct:"First: g(2) = 2(2)‚àí1 = 3. Then: f(3) = 9+9 = 18."}},

{num:33,module:2,type:"MC",passage:"",
question:"Which of the following is equivalent to ‚àö(50x‚Å¥)?",
A:"5x¬≤‚àö2",B:"25x¬≤‚àö2",C:"5x¬≤",D:"25x¬≤",
correct:"A",domain:"Advanced Math",skill:"Radicals",
explanations:{
A:"‚àö(50x‚Å¥) = ‚àö(25¬∑2¬∑x‚Å¥) = 5x¬≤‚àö2. ‚úì",
B:"Incorrectly squared the 5: 5¬≤ = 25.",
C:"Dropped the ‚àö2 factor.",
D:"Both errors combined."}},

{num:34,module:2,type:"MC",
passage:"The value of a certain collectible is modeled by V(t) = 250(1.08)^t, where t is the number of years since purchase.",
question:"Which of the following best describes the meaning of 1.08 in this context?",
A:"The collectible's value increases by $1.08 each year.",
B:"The collectible's value increases by 8% each year.",
C:"The collectible will be worth $1.08 after one year.",
D:"The collectible's initial value was $1.08.",
correct:"B",domain:"Advanced Math",skill:"Exponential growth interpretation",
explanations:{
A:"1.08 is a growth factor (multiplier), not a dollar amount. The increase is by 8%, not $1.08.",
B:"In V = 250(1.08)^t, the base 1.08 = 1 + 0.08, meaning 8% annual growth. ‚úì",
C:"V(1) = 250(1.08) = 270, not 1.08.",
D:"The initial value is 250 (when t=0)."}},

{num:35,module:2,type:"MC",passage:"",
question:"For i = ‚àö(‚àí1), what is the value of (3 + 2i)(3 ‚àí 2i)?",
A:"5",B:"9",C:"13",D:"9 ‚àí 4i¬≤",
correct:"C",domain:"Advanced Math",skill:"Complex numbers",
explanations:{
A:"5 = 9‚àí4, but i¬≤ = ‚àí1, so ‚àí4i¬≤ = ‚àí4(‚àí1) = +4, giving 9+4 = 13.",
B:"9 would be just 3¬≤, ignoring the imaginary terms entirely.",
C:"(3+2i)(3‚àí2i) = 9‚àí4i¬≤ = 9‚àí4(‚àí1) = 9+4 = 13. This is a conjugate pair product. ‚úì",
D:"This is technically an intermediate step, not simplified. Since i¬≤=‚àí1, this equals 9+4=13."}},

{num:36,module:2,type:"SPR",passage:"",
question:"If x¬≤ + bx + 9 is a perfect square trinomial with b > 0, what is the value of b?",
correct:"6",domain:"Advanced Math",skill:"Completing the square",
explanations:{
correct:"A perfect square trinomial x¬≤ + bx + 9 = (x + k)¬≤ means k¬≤ = 9 and 2k = b. So k = 3 (since b > 0) and b = 6."}},

// --- PROBLEM-SOLVING & DATA ANALYSIS (Q37-39) ---
{num:37,module:2,type:"MC",
passage:"In a random sample of 400 voters, 52% said they support a proposed policy. The margin of error is ¬±4 percentage points at the 95% confidence level.",
question:"Which of the following is the best interpretation of this result?",
A:"Exactly 52% of all voters support the policy.",
B:"Between 48% and 56% of the sample supports the policy.",
C:"It is plausible that between 48% and 56% of all voters support the policy.",
D:"95% of all voters have an opinion about the policy.",
correct:"C",domain:"Problem-Solving & Data Analysis",skill:"Confidence intervals / margin of error",
explanations:{
A:"52% is the sample statistic, not the exact population parameter.",
B:"We know the sample result is 52%. The interval is about the population, not the sample.",
C:"The 95% confidence interval is 52% ¬± 4% = [48%, 56%]. We're 95% confident the true population proportion falls in this range. ‚úì",
D:"The 95% refers to confidence level, not the percentage of voters with opinions."}},

{num:38,module:2,type:"MC",
passage:"A researcher wants to determine whether a new fertilizer increases crop yield. She randomly assigns 50 plots to receive the new fertilizer and 50 plots to receive the standard fertilizer, then measures yield.",
question:"Which of the following best describes this study?",
A:"An observational study, because the researcher recorded existing conditions.",
B:"A survey, because the researcher collected data from multiple plots.",
C:"An experiment, because treatments were randomly assigned to groups.",
D:"A census, because all plots in the field were included.",
correct:"C",domain:"Problem-Solving & Data Analysis",skill:"Study design",
explanations:{
A:"This is not observational ‚Äî the researcher actively assigned treatments.",
B:"Surveys collect self-reported data from people; this measures crop yield.",
C:"Random assignment of treatments to experimental units = experiment. This allows causal inference. ‚úì",
D:"A census measures every member of a population, not a sample of plots."}},

{num:39,module:2,type:"SPR",
passage:"A jar contains 5 red, 8 blue, and 7 green marbles. One marble is selected at random.",
question:"What is the probability of selecting a blue marble? (Enter as a decimal.)",
correct:"0.4",domain:"Problem-Solving & Data Analysis",skill:"Probability",
explanations:{
correct:"Total marbles: 5+8+7 = 20. P(blue) = 8/20 = 2/5 = 0.4."}},

// --- GEOMETRY & TRIGONOMETRY (Q40-44) ---
{num:40,module:2,type:"MC",passage:"",
question:"A cone has a radius of 6 cm and a height of 10 cm. What is the volume of the cone, in cubic centimeters?",
A:"60œÄ",B:"120œÄ",C:"180œÄ",D:"360œÄ",
correct:"B",domain:"Geometry & Trigonometry",skill:"Volume (cone)",
explanations:{
A:"60œÄ = (1/3)œÄ(6)(10) ‚Äî used r instead of r¬≤.",
B:"V = (1/3)œÄr¬≤h = (1/3)œÄ(36)(10) = 120œÄ. ‚úì",
C:"180œÄ = (1/2)œÄr¬≤h ‚Äî used 1/2 instead of 1/3.",
D:"360œÄ = œÄr¬≤h ‚Äî forgot the 1/3 factor."}},

{num:41,module:2,type:"MC",passage:"",
question:"In a coordinate plane, segment AB has endpoints A(1, 3) and B(7, 11). What is the length of AB?",
A:"8",B:"10",C:"12",D:"14",
correct:"B",domain:"Geometry & Trigonometry",skill:"Distance formula",
explanations:{
A:"8 is the difference in y-coordinates (11‚àí3), not the distance.",
B:"d = ‚àö((7‚àí1)¬≤+(11‚àí3)¬≤) = ‚àö(36+64) = ‚àö100 = 10. ‚úì",
C:"Added the differences: 6+8 = 14? No, that's D. 12 has no basis.",
D:"6+8 = 14 is the sum of the legs, not the hypotenuse."}},

{num:42,module:2,type:"SPR",passage:"",
question:"Two similar triangles have corresponding sides in a ratio of 3:5. If the area of the smaller triangle is 27 cm¬≤, what is the area of the larger triangle, in cm¬≤?",
correct:"75",domain:"Geometry & Trigonometry",skill:"Similar figures (area ratios)",
explanations:{
correct:"Area ratio = (side ratio)¬≤ = (3/5)¬≤ = 9/25. So 27/A = 9/25 ‚Üí A = 27 √ó 25/9 = 75 cm¬≤."}},

{num:43,module:2,type:"MC",passage:"",
question:"In a circle with center O, a central angle measures 120¬∞. If the radius is 9, what is the length of the arc intercepted by this angle?",
A:"3œÄ",B:"6œÄ",C:"9œÄ",D:"12œÄ",
correct:"B",domain:"Geometry & Trigonometry",skill:"Arc length",
explanations:{
A:"3œÄ uses the wrong fraction: (120/360)=1/3, and 1/3 of 2œÄ(9) = 6œÄ, not 3œÄ.",
B:"Arc length = (Œ∏/360)√ó2œÄr = (120/360)√ó2œÄ(9) = (1/3)(18œÄ) = 6œÄ. ‚úì",
C:"9œÄ = œÄr, which would be a semicircle arc (180¬∞), not 120¬∞.",
D:"12œÄ uses 2/3 of the circumference, which is the major arc (240¬∞), not the minor arc."}},

{num:44,module:2,type:"MC",passage:"",
question:"In the xy-plane, what is the equation of a circle with center (‚àí2, 5) and radius 7?",
A:"(x + 2)¬≤ + (y ‚àí 5)¬≤ = 7",
B:"(x ‚àí 2)¬≤ + (y + 5)¬≤ = 49",
C:"(x + 2)¬≤ + (y ‚àí 5)¬≤ = 49",
D:"(x ‚àí 2)¬≤ + (y ‚àí 5)¬≤ = 49",
correct:"C",domain:"Geometry & Trigonometry",skill:"Circle equations",
explanations:{
A:"Right center but forgot to square the radius: r¬≤=49, not 7.",
B:"Signs wrong for center: (x‚àí2) gives center x=2, not ‚àí2. (y+5) gives center y=‚àí5.",
C:"(x‚àí(‚àí2))¬≤ + (y‚àí5)¬≤ = 7¬≤ ‚Üí (x+2)¬≤ + (y‚àí5)¬≤ = 49. ‚úì",
D:"(x‚àí2)¬≤ gives center x=2, not ‚àí2. Must use (x+2)¬≤ for center at x=‚àí2."}}
];

// ============================================================
// APP STATE
// ============================================================
let state = {
  screen: 'landing', // landing, test, review, results
  currentQ: 0,
  answers: {},
  flags: new Set(),
  startTime: null,
  moduleStartTime: null,
  module1Time: null,
  module2Time: null,
  submitted: false,
  showExplanation: {}
};

function render() {
  const app = document.getElementById('app');
  switch(state.screen) {
    case 'landing': app.innerHTML = renderLanding(); break;
    case 'test': app.innerHTML = renderTest(); break;
    case 'results': app.innerHTML = renderResults(); break;
  }
}

// ============================================================
// LANDING SCREEN
// ============================================================
function renderLanding() {
  return `
    <a class="back-to-app" href="../index.html">‚Üê Back to PantherPrep</a>
    <div class="landing">
      <div class="landing-badge">üêæ PantherPrep Diagnostic</div>
      <h1>SAT Math Diagnostic</h1>
      <p class="subtitle">44 questions ¬∑ 2 adaptive modules ¬∑ 70 minutes total</p>
      <div class="spec-grid">
        <div class="spec-card"><div class="label">Questions</div><div class="value">44 total</div></div>
        <div class="spec-card"><div class="label">Format</div><div class="value">MC + SPR</div></div>
        <div class="spec-card"><div class="label">Time</div><div class="value">35 min √ó 2</div></div>
        <div class="spec-card"><div class="label">Score Range</div><div class="value">200 ‚Äì 800</div></div>
      </div>
      <div class="domain-bar"><div></div><div></div><div></div><div></div></div>
      <div class="domain-legend">
        <span class="alg">Algebra (35%)</span>
        <span class="adv">Advanced Math (35%)</span>
        <span class="psd">PS & Data (15%)</span>
        <span class="geo">Geometry & Trig (15%)</span>
      </div>
      <p style="font-size:0.9rem;color:var(--muted);margin-bottom:8px;">Module 2 simulates the <strong>upper difficulty path</strong> of the adaptive SAT.</p>
      <p style="font-size:0.85rem;color:var(--muted);margin-bottom:28px;">Calculator allowed throughout. ~25% are student-produced response (SPR) questions.</p>
      <button class="btn" onclick="startTest()">Begin Diagnostic</button>
    </div>
  `;
}

function startTest() {
  state.screen = 'test';
  state.currentQ = 0;
  state.startTime = Date.now();
  state.moduleStartTime = Date.now();
  render();
}

// ============================================================
// TEST SCREEN
// ============================================================
function renderTest() {
  const q = ALL_QUESTIONS[state.currentQ];
  const module = q.module;
  const moduleQs = ALL_QUESTIONS.filter(x => x.module === module);
  const moduleIdx = moduleQs.indexOf(q);
  const isSubmitted = state.submitted;
  const userAnswer = state.answers[q.num];
  const isFlagged = state.flags.has(q.num);
  const showExp = state.showExplanation[q.num];

  const domainClass = q.domain === 'Algebra' ? 'algebra' : q.domain === 'Advanced Math' ? 'advanced' : q.domain === 'Problem-Solving & Data Analysis' ? 'psda' : 'geotrig';

  // Question navigator
  const startIdx = module === 1 ? 0 : 22;
  const endIdx = module === 1 ? 22 : 44;
  let navHtml = '';
  for(let i = startIdx; i < endIdx; i++) {
    const qn = ALL_QUESTIONS[i].num;
    let cls = '';
    if(i === state.currentQ) cls = 'current';
    else if(state.answers[qn] !== undefined) cls = 'answered';
    if(state.flags.has(qn) && i !== state.currentQ) cls += ' flagged';
    navHtml += `<button class="${cls}" onclick="goToQ(${i})">${qn}</button>`;
  }

  // Choices or SPR input
  let inputHtml = '';
  if(q.type === 'MC') {
    inputHtml = `<div class="choices">`;
    for(const letter of ['A','B','C','D']) {
      let cls = 'choice';
      if(!isSubmitted && userAnswer === letter) cls += ' selected';
      if(isSubmitted) {
        if(letter === q.correct) cls += ' correct-choice';
        else if(userAnswer === letter) cls += ' wrong-choice';
      }
      inputHtml += `<div class="${cls}" onclick="selectAnswer('${letter}')">
        <div class="choice-letter">${letter}</div>
        <div class="choice-text">${q[letter]}</div>
      </div>`;
    }
    inputHtml += `</div>`;
  } else {
    const val = userAnswer || '';
    let inputCls = '';
    if(isSubmitted) {
      inputCls = checkSPR(val, q.correct) ? 'style="border-color:var(--correct);background:var(--correct-bg)"' : 'style="border-color:var(--wrong);background:var(--wrong-bg)"';
    }
    inputHtml = `<div class="spr-input">
      <input type="text" id="sprInput" value="${val}" placeholder="Your answer" ${inputCls} ${isSubmitted?'disabled':''} onkeyup="handleSPRKey(event)">
      ${!isSubmitted ? '<button class="btn btn-sm" onclick="submitSPR()">Enter</button>' : ''}
    </div>`;
    if(isSubmitted) {
      inputHtml += `<p style="font-size:0.9rem;color:var(--muted);">Correct answer: <strong>${q.correct}</strong></p>`;
    }
  }

  // Explanation
  let expHtml = '';
  if(isSubmitted && showExp) {
    const isCorrect = q.type === 'MC' ? userAnswer === q.correct : checkSPR(userAnswer, q.correct);
    const expClass = isCorrect ? 'correct' : 'wrong';
    if(q.type === 'MC') {
      expHtml = `<div class="explanation-box ${expClass}">
        <h4>${isCorrect ? '‚úì Correct!' : '‚úó Incorrect'}</h4>
        ${Object.entries(q.explanations).map(([k,v]) => `<div class="exp-item"><strong>${k}.</strong> ${v}</div>`).join('')}
      </div>`;
    } else {
      expHtml = `<div class="explanation-box ${expClass}">
        <h4>${isCorrect ? '‚úì Correct!' : '‚úó Incorrect'}</h4>
        <div>${q.explanations.correct}</div>
      </div>`;
    }
  }

  // Reference sheet
  const refHtml = `<details class="reference-sheet">
    <summary>üìê Reference Formulas</summary>
    <div class="formulas">
      <p>A = œÄr¬≤</p><p>C = 2œÄr</p>
      <p>A = ¬Ωbh</p><p>A = lw</p>
      <p>V = lwh</p><p>V = œÄr¬≤h</p>
      <p>V = ‚ÖìœÄr¬≤h</p><p>V = (4/3)œÄr¬≥</p>
      <p>V = ‚Öìlwh</p>
      <p>c¬≤ = a¬≤ + b¬≤</p>
      <p>x = (‚àíb ¬± ‚àö(b¬≤‚àí4ac)) / 2a</p>
      <p>Special ‚ñ≥: 45-45-90 ‚Üí 1:1:‚àö2</p>
      <p>Special ‚ñ≥: 30-60-90 ‚Üí 1:‚àö3:2</p>
      <p>sin = opp/hyp, cos = adj/hyp</p>
      <p>tan = opp/adj</p>
      <p>Arc = (Œ∏/360)¬∑2œÄr</p>
      <p>Sector = (Œ∏/360)¬∑œÄr¬≤</p>
    </div>
  </details>`;

  return `
    <div class="test-header">
      <div class="module-label">Module ${module} of 2${module===2?' ‚Äî Hard Path':''}</div>
      <div class="timer" id="timer">35:00</div>
    </div>
    <div class="progress-bar"><div class="progress-fill" style="width:${((moduleIdx+1)/22)*100}%"></div></div>
    <div class="q-nav">${navHtml}</div>
    ${refHtml}
    <div class="q-counter">Question ${q.num} of 44</div>
    <span class="domain-tag ${domainClass}">${q.domain}</span>
    ${q.type==='SPR'?'<span class="spr-badge">Student-Produced Response</span>':''}
    ${q.passage ? `<div class="passage">${q.passage.replace(/\n/g,'<br>')}</div>` : ''}
    <div class="q-text">${q.question}</div>
    ${inputHtml}
    ${expHtml}
    ${!isSubmitted && !showExp ? `<div style="text-align:center;margin-bottom:16px;">
      <button class="btn btn-sm" onclick="checkAnswer()">Check Answer</button>
    </div>` : ''}
    ${isSubmitted && !showExp ? `<div style="text-align:center;margin-bottom:16px;">
      <button class="btn btn-sm btn-outline" onclick="toggleExplanation(${q.num})">Show Explanation</button>
    </div>` : ''}
    <div class="nav-buttons">
      <div style="display:flex;gap:8px;">
        ${state.currentQ > 0 ? '<button class="btn btn-sm btn-outline" onclick="prevQ()">‚Üê Previous</button>' : '<span></span>'}
        <button class="flag-btn ${isFlagged?'flagged':''}" onclick="toggleFlag(${q.num})">${isFlagged?'üö© Flagged':'üè≥ Flag'}</button>
      </div>
      ${state.currentQ < 43 ?
        `<button class="btn btn-sm" onclick="nextQ()">Next ‚Üí</button>` :
        `<button class="btn btn-sm" style="background:#16a34a" onclick="finishTest()">Finish Test</button>`
      }
    </div>
    ${state.currentQ === 21 && module === 1 ? `<div style="text-align:center;margin-top:20px;padding:16px;background:rgba(124,58,237,.12);border:1px solid rgba(124,58,237,.3);border-radius:10px;color:#a78bfa;">
      <strong>End of Module 1.</strong> Click "Next" to begin Module 2 (harder difficulty).</div>` : ''}
  `;
}

function selectAnswer(letter) {
  if(state.submitted) return;
  state.answers[ALL_QUESTIONS[state.currentQ].num] = letter;
  state.submitted = false;
  render();
}

function submitSPR() {
  const input = document.getElementById('sprInput');
  if(input && input.value.trim()) {
    state.answers[ALL_QUESTIONS[state.currentQ].num] = input.value.trim();
  }
}

function handleSPRKey(e) {
  if(e.key === 'Enter') {
    submitSPR();
    checkAnswer();
  } else {
    const input = document.getElementById('sprInput');
    state.answers[ALL_QUESTIONS[state.currentQ].num] = input.value.trim();
  }
}

function checkAnswer() {
  const q = ALL_QUESTIONS[state.currentQ];
  if(state.answers[q.num] === undefined) return;
  state.submitted = true;
  state.showExplanation[q.num] = true;
  render();
}

function toggleExplanation(num) {
  state.showExplanation[num] = !state.showExplanation[num];
  render();
}

function checkSPR(answer, correct) {
  if(!answer) return false;
  const a = parseFloat(answer);
  const c = parseFloat(correct);
  if(isNaN(a) || isNaN(c)) return answer.trim().toLowerCase() === correct.trim().toLowerCase();
  return Math.abs(a - c) < 0.01;
}

function nextQ() {
  if(state.currentQ === 21) {
    state.module1Time = Date.now() - state.moduleStartTime;
    state.moduleStartTime = Date.now();
  }
  state.currentQ = Math.min(43, state.currentQ + 1);
  state.submitted = false;
  render();
  window.scrollTo(0, 0);
}

function prevQ() {
  state.currentQ = Math.max(0, state.currentQ - 1);
  state.submitted = state.answers[ALL_QUESTIONS[state.currentQ].num] !== undefined;
  render();
  window.scrollTo(0, 0);
}

function goToQ(idx) {
  state.currentQ = idx;
  state.submitted = state.answers[ALL_QUESTIONS[state.currentQ].num] !== undefined;
  render();
  window.scrollTo(0, 0);
}

function toggleFlag(num) {
  if(state.flags.has(num)) state.flags.delete(num);
  else state.flags.add(num);
  render();
}

function finishTest() {
  state.module2Time = Date.now() - state.moduleStartTime;
  state.screen = 'results';
  render();
  window.scrollTo(0, 0);
}

// ============================================================
// RESULTS SCREEN
// ============================================================
function renderResults() {
  const totalQ = ALL_QUESTIONS.length;
  let correctCount = 0;
  let domainStats = {};
  const domains = ['Algebra','Advanced Math','Problem-Solving & Data Analysis','Geometry & Trigonometry'];
  domains.forEach(d => domainStats[d] = {correct:0,total:0});

  ALL_QUESTIONS.forEach(q => {
    domainStats[q.domain].total++;
    const ans = state.answers[q.num];
    let isCorrect = false;
    if(q.type === 'MC') isCorrect = ans === q.correct;
    else isCorrect = checkSPR(ans, q.correct);
    if(isCorrect) {
      correctCount++;
      domainStats[q.domain].correct++;
    }
  });

  const pct = correctCount / totalQ;
  // Rough SAT score mapping
  const rawToScaled = Math.round(200 + pct * 600);
  const answered = Object.keys(state.answers).length;
  const skipped = totalQ - answered;
  const wrong = answered - correctCount;

  const totalTime = (state.module1Time || 0) + (state.module2Time || 0);
  const m1Min = state.module1Time ? Math.floor(state.module1Time / 60000) : '‚Äî';
  const m2Min = state.module2Time ? Math.floor(state.module2Time / 60000) : '‚Äî';

  const domainColors = {'Algebra':'#60a5fa','Advanced Math':'#a78bfa','Problem-Solving & Data Analysis':'#34d399','Geometry & Trigonometry':'#fb923c'};

  let domainHtml = domains.map(d => {
    const s = domainStats[d];
    const p = s.total > 0 ? Math.round(s.correct/s.total*100) : 0;
    return `<div class="domain-result-row">
      <div class="dr-name" style="color:${domainColors[d]}">${d}</div>
      <div class="dr-bar-wrap"><div class="dr-bar" style="width:${p}%;background:${domainColors[d]}"></div></div>
      <div class="dr-score">${s.correct}/${s.total}</div>
    </div>`;
  }).join('');

  // Review all questions
  let reviewHtml = ALL_QUESTIONS.map(q => {
    const ans = state.answers[q.num];
    let status, statusClass;
    if(ans === undefined) { status = 'Skipped'; statusClass = 'skipped'; }
    else {
      const isC = q.type==='MC' ? ans===q.correct : checkSPR(ans,q.correct);
      status = isC ? '‚úì Correct' : '‚úó Incorrect';
      statusClass = isC ? 'correct' : 'wrong';
    }
    const domClass = q.domain==='Algebra'?'algebra':q.domain==='Advanced Math'?'advanced':q.domain==='Problem-Solving & Data Analysis'?'psda':'geotrig';
    return `<div class="review-q">
      <div class="rq-header">
        <div><strong>Q${q.num}</strong> <span class="domain-tag ${domClass}" style="font-size:10px;padding:2px 8px;">${q.domain}</span></div>
        <div class="rq-status ${statusClass}">${status}</div>
      </div>
      <div style="font-size:0.9rem;color:var(--muted);margin-bottom:4px;">${q.question.substring(0,80)}${q.question.length>80?'...':''}</div>
      <div style="font-size:0.85rem;">Your answer: <strong>${ans||'‚Äî'}</strong> ¬∑ Correct: <strong>${q.correct}</strong></div>
    </div>`;
  }).join('');

  // Strength/weakness analysis
  let strengths = [], weaknesses = [];
  domains.forEach(d => {
    const s = domainStats[d];
    const p = s.total>0 ? s.correct/s.total : 0;
    if(p >= 0.7) strengths.push(d);
    else weaknesses.push(d);
  });

  return `
    <div class="results">
      <h1>Diagnostic Results</h1>
      <p style="color:var(--muted);">SAT Math ¬∑ ${totalQ} Questions</p>
      <div class="score-circle">
        <div class="score-num">${rawToScaled}</div>
        <div class="score-range">/ 800</div>
      </div>
      <div class="stats-row">
        <div class="stat-box"><div class="stat-val" style="color:var(--correct)">${correctCount}</div><div class="stat-label">Correct</div></div>
        <div class="stat-box"><div class="stat-val" style="color:var(--wrong)">${wrong}</div><div class="stat-label">Incorrect</div></div>
        <div class="stat-box"><div class="stat-val" style="color:var(--muted)">${skipped}</div><div class="stat-label">Skipped</div></div>
        <div class="stat-box"><div class="stat-val">${Math.round(pct*100)}%</div><div class="stat-label">Accuracy</div></div>
      </div>
      <div class="stats-row">
        <div class="stat-box"><div class="stat-val">${m1Min}m</div><div class="stat-label">Module 1 Time</div></div>
        <div class="stat-box"><div class="stat-val">${m2Min}m</div><div class="stat-label">Module 2 Time</div></div>
      </div>

      <div class="domain-results">
        <h3 style="font-family:'DM Serif Display',serif;margin-bottom:12px;">Performance by Domain</h3>
        ${domainHtml}
      </div>

      ${strengths.length ? `<div style="text-align:left;margin:20px 0;padding:16px;background:var(--correct-bg);border-radius:10px;border:1px solid rgba(34,197,94,.3)">
        <strong style="color:var(--correct);">üí™ Strengths:</strong> ${strengths.join(', ')}
      </div>` : ''}
      ${weaknesses.length ? `<div style="text-align:left;margin:20px 0;padding:16px;background:var(--wrong-bg);border-radius:10px;border:1px solid rgba(239,68,68,.3)">
        <strong style="color:var(--wrong);">üéØ Focus Areas:</strong> ${weaknesses.join(', ')}
      </div>` : ''}

      <div class="review-section">
        <h3>Question Review</h3>
        ${reviewHtml}
      </div>

      <div class="reflection-section">
        <h3>üìù Post-Test Reflection</h3>
        <div class="reflection-q">
          <label>1. Which question types felt most challenging?</label>
          <textarea placeholder="e.g., word problems, systems of equations, trig ratios..."></textarea>
        </div>
        <div class="reflection-q">
          <label>2. Were there questions where you knew the concept but made a calculation error?</label>
          <textarea placeholder="Identify any careless mistakes..."></textarea>
        </div>
        <div class="reflection-q">
          <label>3. Which topics do you need to review before the SAT?</label>
          <textarea placeholder="List specific skills or concepts..."></textarea>
        </div>
        <div class="reflection-q">
          <label>4. How did Module 2 (harder) feel compared to Module 1?</label>
          <textarea placeholder="Was the difficulty jump noticeable? Where?"></textarea>
        </div>
        <div class="reflection-q">
          <label>5. Rate your pacing: Did you have enough time in each module?</label>
          <textarea placeholder="Too fast? Too slow? Rushed at the end?"></textarea>
        </div>
        <div class="reflection-q">
          <label>6. If you've taken the PSAT diagnostic, how does this compare?</label>
          <textarea placeholder="Harder? Different topics? Same weak areas?"></textarea>
        </div>
        <div class="reflection-q">
          <label>7. What are your top 3 priorities for SAT Math prep?</label>
          <textarea placeholder="Be specific: e.g., quadratic vertex form, trig word problems, pacing..."></textarea>
        </div>
      </div>

      <div style="text-align:center;margin-top:30px;">
        <button class="btn btn-outline" onclick="retakeTest()">‚Üª Retake Test</button>
      </div>
    </div>
  `;
}

function retakeTest() {
  state = {
    screen:'landing', currentQ:0, answers:{}, flags:new Set(),
    startTime:null, moduleStartTime:null, module1Time:null, module2Time:null,
    submitted:false, showExplanation:{}
  };
  render();
  window.scrollTo(0,0);
}

// Initialize
render();
</script>
<script src="/translate.js"></script></body>
</html>
